{% extends "base.html" %}
{% load static %}

{% block title %}Книжные марафоны — Калейдоскоп книг{% endblock %}

{% block extra_css %}
  {{ block.super }}
  <style>
    /* ===== Палитра страницы марафонов ===== */
    .marathon-theme{
      --page-primary:#9d6f51;                 /* кнопки/активы */
      --page-primary-rgb:157,111,81;
      --hero-bg:#e1b797;                      /* фон шапки */

      --card-bg:#f3e6dd;                      /* фон карточек */
      --card-bg-hover:#efe0d5;
      --card-border:rgba(157,111,81,.25);
      --card-shadow:0 10px 24px rgba(157,111,81,.10);

      /* прокидываем в bootstrap */
      --bs-primary:var(--page-primary);
      --bs-primary-rgb:var(--page-primary-rgb);
    }

    /* ===== Шапка ===== */
    .marathon-theme .marathon-hero{
      background:var(--hero-bg);
      color:#000;
      border:1px solid rgba(0,0,0,.08);
      border-radius:1rem;
      padding:1.75rem 1.5rem;
      box-shadow:0 18px 40px rgba(0,0,0,.10);
    }
    .marathon-theme .marathon-hero .lead{ color:#000; opacity:.9; }

    /* ===== Кнопки ===== */
    .marathon-theme .btn-primary{
      --bs-btn-bg:var(--page-primary);
      --bs-btn-border-color:var(--page-primary);
      --bs-btn-hover-bg:#b48264;
      --bs-btn-hover-border-color:#b48264;
      --bs-btn-active-bg:var(--page-primary);
      --bs-btn-active-border-color:var(--page-primary);
      color:#fff !important;
      background-color:var(--bs-btn-bg);
      border-color:var(--bs-btn-border-color);
    }
    .marathon-theme .btn-outline-primary{
      --bs-btn-color:var(--page-primary);
      --bs-btn-border-color:var(--page-primary);
      --bs-btn-hover-bg:var(--page-primary);
      --bs-btn-hover-border-color:var(--page-primary);
      color:var(--page-primary);
      border-color:var(--page-primary);
    }
    .marathon-theme .btn-outline-primary:hover{ color:#fff !important; }

    /* ===== Карточки марафонов ===== */
    .marathon-theme .marathon-card.card{
      background:var(--card-bg);
      border:1px solid var(--card-border);
      border-radius:1rem;
      box-shadow:var(--card-shadow);
      transition:transform .15s ease, box-shadow .15s ease, background-color .15s ease;
      overflow:hidden;
    }
    .marathon-theme .marathon-card.card:hover{
      transform:translateY(-2px);
      box-shadow:0 14px 36px rgba(157,111,81,.16);
      background:var(--card-bg-hover);
    }

    .marathon-theme .marathon-card__cover{
      max-height: 260px;
      object-fit: cover;
    }

    /* бейджи тем */
    .marathon-theme .marathon-theme-badge{
      display:inline-block;
      padding:.25rem .5rem;
      border:1px solid rgba(157,111,81,.35);
      border-radius:999px;
      background:rgba(157,111,81,.10);
      color:#5a3c2b;
      font-size:.875rem;
      line-height:1;
      white-space:nowrap;
    }
    .marathon-theme .badge.bg-light.text-dark{
      background:rgba(157,111,81,.12) !important;
      color:#5a3c2b !important;
      border:1px solid rgba(157,111,81,.25);
    }

    /* мобила — мягче отступы */
    @media (max-width: 575.98px){
      .marathon-theme .marathon-hero{ padding:1.25rem; }
    }
  </style>
{% endblock %}

{% block content %}
<div class="marathon-theme">
  <section class="marathon-hero mb-4">
    <div class="row align-items-center g-4">
      <div class="col-lg-8">
        <h1 class="h2 mb-3">Книжные марафоны</h1>
        <p class="lead mb-0">Создавайте тематические забеги по чтению, приглашайте друзей и делитесь прогрессом по выбранным книгам. Создание Марафона 100 монет, баланс у вас в профиле</p>
      </div>
      <div class="col-lg-4 text-lg-end">
        {% if request.user.is_authenticated %}
          <a class="btn btn-primary" href="{% url 'reading_marathons:create' %}">
            <i class="bi bi-flag me-2"></i>Создать марафон
          </a>
        {% else %}
          <a class="btn btn-primary" href="{% url 'login' %}">Войдите, чтобы создать марафон</a>
        {% endif %}
      </div>
    </div>
  </section>

  <div class="row g-4">
    {% for marathon in marathons %}
      <div class="col-md-6 col-lg-4">
        <div class="card marathon-card h-100">
          {% if marathon.cover %}
            <img class="marathon-card__cover card-img-top object-fit-cover"
                 src="{{ marathon.cover.url }}"
                 alt="Обложка марафона {{ marathon.title }}">
          {% endif %}
          <div class="card-body d-flex flex-column">
            <h2 class="h5">{{ marathon.title }}</h2>
            <p class="text-muted flex-grow-1">{{ marathon.description|truncatewords:30 }}</p>

            <div class="d-flex flex-wrap gap-2 mb-3">
              {% for theme in marathon.themes.all|slice:':3' %}
                <span class="marathon-theme-badge">{{ theme.title }}</span>
              {% endfor %}
              {% if marathon.themes.all|length > 3 %}
                <span class="badge bg-light text-dark">
                  +{{ marathon.themes.all|length|add:'-3' }} тем
                </span>
              {% endif %}
            </div>

            <a class="btn btn-outline-primary mt-auto"
               href="{% url 'reading_marathons:detail' marathon.slug %}">
              Открыть марафон
            </a>
          </div>
        </div>
      </div>
    {% empty %}
      <div class="col-12">
        <div class="alert alert-light border">
          Пока нет созданных марафонов. Будьте первым, кто запустит новый забег по чтению!
        </div>
      </div>
    {% endfor %}
  </div>
</div>
{% if not user.profile.has_active_premium %}
<!-- Yandex.RTB R-A-17641153-1 -->
<script>
window.yaContextCb.push(() => {
    Ya.Context.AdvManager.render({
        "blockId": "R-A-17641153-1",
        "type": "floorAd",
        "platform": "desktop"
    })
})
</script>
<!-- Yandex.RTB R-A-17641153-4 -->
<script>
window.yaContextCb.push(() => {
    Ya.Context.AdvManager.render({
        "blockId": "R-A-17641153-4",
        "type": "floorAd",
        "platform": "touch"
    })
})
</script>
{% endif %}
{% endblock %}
