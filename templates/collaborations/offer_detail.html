{% extends "base.html" %}
{% load i18n %}

{% block title %}{{ offer.title }} · {{ block.super }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center flex-wrap gap-3 mb-4">
  <div>
    <h1 class="h3 mb-1">{{ offer.title }}</h1>
    <p class="text-muted mb-0">{% trans "Предложение автора" %}</p>
  </div>
  <span class="badge text-bg-primary fs-6">{{ offer.get_offered_format_display }}</span>
</div>

<div class="row g-4">
  <div class="col-lg-8">
    <div class="card shadow-sm">
      <div class="card-body">
        {% if offer.synopsis %}
          <h2 class="h5">{% trans "О книге" %}</h2>
          <p>{{ offer.synopsis|linebreaks }}</p>
          <hr>
        {% endif %}

        <h2 class="h5">{% trans "Требования к отзыву" %}</h2>
        <p>{{ offer.review_requirements|linebreaks }}</p>

        <dl class="row small text-muted mt-4">
          <dt class="col-sm-5">{% trans "Автор" %}</dt>
          <dd class="col-sm-7">{{ offer.author.get_full_name|default:offer.author.username }}</dd>

          <dt class="col-sm-5">{% trans "Объем текста" %}</dt>
          <dd class="col-sm-7">
            {% if offer.text_review_length %}
              {{ offer.text_review_length }} {% trans "слов/знаков" %}
            {% else %}
              {% trans "На усмотрение блогера" %}
            {% endif %}
          </dd>

          <dt class="col-sm-5">{% trans "Принимаются видеоотзывы" %}</dt>
          <dd class="col-sm-7">{{ offer.get_video_review_type_display }}</dd>

          {% if offer.video_review_type != offer.VideoReviewType.NONE %}
            <dt class="col-sm-5">{% trans "Дополнительно" %}</dt>
            <dd class="col-sm-7">
              <ul class="list-unstyled mb-0">
                <li>
                  {% if offer.video_requires_unboxing %}
                    <i class="bi bi-check2 text-success me-1"></i>{% trans "Распаковка" %}
                  {% else %}
                    <i class="bi bi-dash text-muted me-1"></i>{% trans "Распаковка не требуется" %}
                  {% endif %}
                </li>
                <li>
                  {% if offer.video_requires_aesthetics %}
                    <i class="bi bi-check2 text-success me-1"></i>{% trans "Эстетика и атмосфера" %}
                  {% else %}
                    <i class="bi bi-dash text-muted me-1"></i>{% trans "Без специальных требований" %}
                  {% endif %}
                </li>
                <li>
                  {% if offer.video_requires_review %}
                    <i class="bi bi-check2 text-success me-1"></i>{% trans "Полноценный видеоотзыв" %}
                  {% else %}
                    <i class="bi bi-dash text-muted me-1"></i>{% trans "Видеоотзыв не обязателен" %}
                  {% endif %}
                </li>
              </ul>
            </dd>
          {% endif %}

          <dt class="col-sm-5">{% trans "Для кого" %}</dt>
          <dd class="col-sm-7">
            {% if offer.allow_regular_users %}
              {% trans "Блогеры и читатели" %}
            {% else %}
              {% trans "Только блогеры" %}
            {% endif %}
          </dd>
        </dl>
      </div>
      {% if offer.considers_paid_collaboration %}
        <div class="card-footer text-warning-emphasis small">
          <i class="bi bi-exclamation-triangle me-1"></i>{{ offer.paid_collaboration_disclaimer }}
        </div>
      {% endif %}
    </div>
  </div>
  <div class="col-lg-4">
    <div class="card shadow-sm">
      <div class="card-header">{% trans "Где нужен отзыв" %}</div>
      <div class="card-body">
        {% with platforms=offer.expected_platforms.all %}
          {% if platforms %}
            <ul class="list-unstyled mb-0">
              {% for platform in platforms %}
                <li class="mb-2"><i class="bi bi-hash text-primary me-1"></i>{{ platform.name }}{% if platform.url %} · <a href="{{ platform.url }}" class="text-muted" target="_blank" rel="noopener">{% trans "ссылка" %}</a>{% endif %}</li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted mb-0">{% trans "Площадки можно обсудить отдельно." %}</p>
          {% endif %}
        {% endwith %}
      </div>
    </div>

    {% if user.is_authenticated %}
      <div class="card shadow-sm mt-4">
        <div class="card-header">{% trans "Откликнуться" %}</div>
        <div class="card-body">
          {% if can_respond %}
            {% if existing_response %}
              <p class="text-muted small mb-3">{% trans "Вы уже откликались на это предложение. Можно обновить сообщение." %}</p>
            {% endif %}
            <form method="post" action="{% url 'collaborations:offer_respond' offer.pk %}">
              {% csrf_token %}
              {{ response_form.as_p }}
              <button type="submit" class="btn btn-primary w-100">
                <i class="bi bi-send me-1"></i>{% trans "Отправить отклик" %}
              </button>
            </form>
          {% else %}
            <p class="text-muted small mb-0">{% trans "Автор ожидает отклики только от блогеров." %}</p>
          {% endif %}
        </div>
      </div>
    {% else %}
      <div class="alert alert-info mt-4" role="alert">
        {% trans "Авторизуйтесь, чтобы откликнуться на предложение." %}
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}