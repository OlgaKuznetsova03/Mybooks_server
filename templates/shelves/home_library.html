{% extends "base.html" %}
{% load shelf_extras %}
{% block title %}–ú–æ—è –¥–æ–º–∞—à–Ω—è—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞{% endblock %}

{% block extra_css %}
<style>
  :root{
    --home-hero-gradient: linear-gradient(130deg,#7f9aaf 0%,#5d7283 42%,#38444e 100%);
    --home-card-bg: rgba(57,69,79,.96);
    --home-card-border: rgba(152,175,192,.45);
    --home-card-shadow: 0 22px 48px rgba(33,42,49,.55);
    --home-text-soft: rgba(244,249,255,.85);
    --home-accent:#c2e0ef;
    --home-accent-strong:#f6c8a2;
    --home-surface: rgba(49,60,69,.95);
    --home-surface-alt: rgba(70,85,97,.82);
    --home-divider: rgba(158,182,201,.35);
  }

  /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
  @keyframes fadeInUp {
    from { 
      opacity: 0; 
      transform: translateY(30px); 
    }
    to { 
      opacity: 1; 
      transform: translateY(0); 
    }
  }
  
  @keyframes slideInRight {
    from { 
      transform: translateX(400px); 
      opacity: 0; 
    }
    to { 
      transform: translateX(0); 
      opacity: 1; 
    }
  }
  
  @keyframes pulseGlow {
    0%, 100% { 
      box-shadow: 0 0 20px rgba(194, 224, 239, 0.3); 
    }
    50% { 
      box-shadow: 0 0 30px rgba(194, 224, 239, 0.6); 
    }
  }

  @keyframes numberCountUp {
    from { 
      transform: scale(0.8);
      opacity: 0.5;
    }
    to { 
      transform: scale(1);
      opacity: 1;
    }
  }

  @keyframes slideInLeft {
    from { 
      transform: translateX(-20px);
      opacity: 0;
    }
    to { 
      transform: translateX(0);
      opacity: 1;
    }
  }

  /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ —Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏ */
  .home-hero{
    position:relative;
    border-radius:24px;
    overflow:hidden;
    background:var(--home-hero-gradient);
    color:#f5f7ff;
    padding:2.5rem 2rem;
    box-shadow:0 25px 55px rgba(24,32,39,.45);
    animation: fadeInUp 0.8s ease-out;
  }
  
  .home-hero::before,
  .home-hero::after{
    content:"";
    position:absolute;
    border-radius:100%;
    filter:blur(65px);
    opacity:.8;
    z-index:0;
  }
  
  .home-hero::before{
    width:360px;
    height:360px;
    top:-120px;
    right:-140px;
    background:rgba(216,232,242,.45);
  }
  
  .home-hero::after{
    width:280px;
    height:280px;
    bottom:-140px;
    left:-110px;
    background:rgba(247,209,176,.4);
  }
  
  .home-hero__content,
  .home-hero__actions{
    position:relative;
    z-index:1;
  }
  
  .home-hero__title{
    font-family:"Montserrat","Segoe UI",system-ui,sans-serif;
    font-weight:700;
    letter-spacing:.02em;
  }
  
  .home-hero__subtitle{
    max-width:520px;
    color:var(--home-text-soft);
  }
  
  .home-hero__actions{
    display:flex;
    flex-wrap:wrap;
    gap:.75rem;
  }
  
  .home-hero__btn{
    border-radius:999px;
    font-weight:600;
    box-shadow:0 12px 28px rgba(8,10,44,.45);
    border:none;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    animation: fadeInUp 0.8s ease-out 0.3s both;
  }
  
  .home-hero__btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.5s;
  }
  
  .home-hero__btn:hover::before {
    left: 100%;
  }
  
  .home-hero__btn:hover,
  .home-hero__btn:focus{
    transform:translateY(-3px) scale(1.02);
    box-shadow:0 18px 32px rgba(8,10,44,.55);
  }
  
  .home-hero__btn.btn-outline-light{
    border:1px solid rgba(255,255,255,.55);
    background:rgba(46,58,68,.55);
    color:#fff;
  }
  
  .home-hero__btn.btn-light{
    color:#1c242b;
  }
  
  .home-hero__btn.btn-outline-light:hover,
  .home-hero__btn.btn-outline-light:focus{
    background:rgba(255,255,255,.15);
  }
  
  .home-hero__btn.btn-light:hover,
  .home-hero__btn.btn-light:focus{
    background:linear-gradient(130deg,#d3e6f1 0%,#f1f6fa 100%);
    color:#11171c;
  }

  /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Å –∞–Ω–∏–º–∞—Ü–∏—è–º–∏ */
  .home-glow-card{
    background:var(--home-card-bg);
    border:1px solid var(--home-card-border);
    border-radius:20px;
    box-shadow:var(--home-card-shadow);
    color:#f8faff;
    padding:1.5rem;
    position:relative;
    overflow:hidden;
    z-index:0;
    animation: fadeInUp 0.6s ease-out;
  }
  
  .home-glow-card:nth-child(1) { animation-delay: 0.1s; }
  .home-glow-card:nth-child(2) { animation-delay: 0.2s; }
  
  .home-glow-card::after{
    content:"";
    position:absolute;
    inset:0;
    border-radius:inherit;
    padding:1px;
    background:linear-gradient(135deg,rgba(194,224,239,.35),rgba(246,200,162,.18));
    -webkit-mask:linear-gradient(#fff 0 0) content-box,linear-gradient(#fff 0 0);
    -webkit-mask-composite:xor;
    mask-composite:exclude;
    pointer-events:none;
    z-index:0;
  }
  
  .home-glow-card>*{
    position:relative;
    z-index:1;
  }

  /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
  .stats-compact {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .stat-item {
    background: rgba(255,255,255,0.05);
    border-radius: 16px;
    padding: 1rem;
    text-align: center;
    transition: all 0.3s ease;
    border: 1px solid rgba(255,255,255,0.1);
    cursor: pointer;
    animation: fadeInUp 0.6s ease-out;
  }

  .stat-item:nth-child(1) { animation-delay: 0.3s; }
  .stat-item:nth-child(2) { animation-delay: 0.4s; }
  .stat-item:nth-child(3) { animation-delay: 0.5s; }
  .stat-item:nth-child(4) { animation-delay: 0.6s; }

  .stat-item:hover {
    transform: translateY(-3px);
    background: rgba(255,255,255,0.08);
    border-color: var(--home-accent);
  }

  .stat-value {
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--home-accent);
    line-height: 1;
    margin-bottom: 0.25rem;
    animation: numberCountUp 1s ease-out;
  }

  .stat-label {
    font-size: 0.75rem;
    color: var(--home-text-soft);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .stat-details {
    font-size: 0.7rem;
    color: rgba(255,255,255,0.6);
    margin-top: 0.25rem;
  }

  /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
  .action-buttons {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  .action-btn {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem 1.25rem;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 16px;
    color: var(--home-text-soft);
    text-decoration: none;
    transition: all 0.3s ease;
    cursor: pointer;
    animation: fadeInUp 0.6s ease-out 0.7s both;
  }

  .action-btn:hover {
    background: rgba(255,255,255,0.08);
    border-color: var(--home-accent);
    transform: translateY(-2px);
    color: var(--home-accent);
    text-decoration: none;
  }

  .action-icon {
    font-size: 1.25rem;
    color: var(--home-accent);
  }

  .action-text {
    flex: 1;
  }

  .action-title {
    font-weight: 600;
    font-size: 0.9rem;
  }

  .action-desc {
    font-size: 0.75rem;
    opacity: 0.8;
    margin-top: 0.1rem;
  }

  /* –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã */
  .search-box {
    margin-bottom: 1.5rem;
    animation: fadeInUp 0.6s ease-out 0.8s both;
  }

  .search-box .input-group {
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }

  .filter-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    animation: fadeInUp 0.6s ease-out 0.9s both;
  }

  .filter-chip {
    padding: 0.5rem 1rem;
    background: var(--home-surface);
    border: 1px solid var(--home-divider);
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.875rem;
    color: var(--home-text-soft);
  }

  .filter-chip:hover {
    background: var(--home-surface-alt);
    transform: translateY(-2px);
  }

  .filter-chip.active {
    background: var(--home-accent);
    color: #1c242b;
    border-color: var(--home-accent);
    animation: pulseGlow 2s infinite;
  }

  /* –ü—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä */
  .home-progress-card{ 
    --home-progress-bought:#38bdf8;
    --home-progress-read:#f97316;
  }

  .home-progress-controls{
    display:flex;
    flex-wrap:wrap;
    gap:.75rem;
    margin-bottom: 1rem;
  }

  .home-progress-stats{
    display:flex;
    align-items:center;
    gap:1.25rem;
    min-width:0;
  }

  .home-progress-side{
    min-width:120px;
  }

  .home-progress-value{
    font-size:2.25rem;
    line-height:1;
    display:inline-flex;
    align-items:center;
    gap:.25rem;
  }

  .home-progress-number{
    font-variant-numeric:tabular-nums;
    animation: numberCountUp 1s ease-out 1s both;
  }

  /* –õ–∏–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ */
  .home-progress-line{
    --bar-h: 10px;
    position:relative;
    flex:1 1 auto;
    min-width:160px;
    height:var(--bar-h);
    border-radius:999px;
    background:rgba(255,255,255,.16);
    overflow:hidden;
    z-index:1;
  }

  .home-progress-fill-left,
  .home-progress-fill-right{
    position:absolute;
    top:0;
    bottom:0;
    width:0%;
    transition: width 1.2s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  .home-progress-fill-left{
    left:0;
    border-top-left-radius:999px;
    border-bottom-left-radius:999px;
    background:var(--home-progress-bought);
  }

  .home-progress-fill-right{
    right:0;
    border-top-right-radius:999px;
    border-bottom-right-radius:999px;
    background:var(--home-progress-read);
  }

  .home-progress-label{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    font-size:.75rem;
    font-weight:600;
    letter-spacing:.05em;
    text-transform:uppercase;
    color:#0f172a;
    text-shadow:0 1px 2px rgba(255,255,255,.8);
    z-index:3;
  }

  /* –¢–∞–±–ª–∏—Ü–∞ */
  .home-library-table{
    background:#fff;
    border-radius:24px;
    border:1px solid #dbe3f0;
    box-shadow:0 18px 40px rgba(15,23,42,.12);
    overflow:hidden;
    color:#1e293b !important;
    animation: fadeInUp 0.6s ease-out 1s both;
  }

  .home-library-table .table{
    color:#1e293b !important;
    margin-bottom:0;
    border-color:#e2e8f0;
  }

  .home-library-table .table thead{
    background:#f8fafc;
  }

  .home-library-table .table thead th{
    border-color:#e2e8f0;
    font-weight:600;
    letter-spacing:.08em;
    text-transform:uppercase;
    font-size:.7rem;
    color:#0f172a !important;
    cursor:pointer;
    transition:background 0.3s ease;
  }

  .home-library-table .table thead th:hover{
    background:#e2e8f0;
  }

  .home-library-table .table tbody tr{
    animation: fadeInUp 0.5s ease-out;
  }

  .home-library-table .table tbody tr:nth-child(1) { animation-delay: 1.1s; }
  .home-library-table .table tbody tr:nth-child(2) { animation-delay: 1.2s; }
  .home-library-table .table tbody tr:nth-child(3) { animation-delay: 1.3s; }
  .home-library-table .table tbody tr:nth-child(4) { animation-delay: 1.4s; }
  .home-library-table .table tbody tr:nth-child(5) { animation-delay: 1.5s; }

  .home-library-table .table tbody td{
    border-color:#e2e8f0;
    vertical-align:top;
    background:#fff;
    color:#1e293b !important;
    transition:all 0.3s ease;
  }

  .home-library-table .table tbody tr:hover td{
    background:#f1f5f9;
    transform:translateY(-2px);
  }

  /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
  .library-notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: var(--home-card-bg);
    border: 1px solid var(--home-card-border);
    border-radius: 12px;
    padding: 1rem;
    box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    z-index: 1060;
    transform: translateX(400px);
    opacity: 0;
    transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    max-width: 300px;
  }
  
  .library-notification.show {
    transform: translateX(0);
    opacity: 1;
  }
  
  .notification-content {
    display: flex;
    align-items: center;
    color: var(--home-text-soft);
  }
  
  .notification-close {
    background: none;
    border: none;
    color: var(--home-text-soft);
    font-size: 1.2rem;
    cursor: pointer;
    margin-left: 1rem;
    transition: color 0.3s ease;
  }

  .notification-close:hover {
    color: var(--home-accent-strong);
  }

  /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –º–æ–¥–∞–ª–æ–∫ */
  .stats-modal .modal-content {
    background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    border-radius: 20px;
    border: none;
    box-shadow: 0 25px 50px rgba(15, 23, 42, 0.25);
  }

  .stats-modal .modal-header {
    background: linear-gradient(135deg, #7f9aaf 0%, #5d7283 100%);
    color: white;
    border: none;
    border-radius: 20px 20px 0 0;
    padding: 1.5rem 2rem;
    position: relative;
  }

  .stats-modal .modal-title {
    font-weight: 700;
    font-size: 1.25rem;
  }

  .stats-modal .modal-body {
    padding: 2rem;
    max-height: 60vh;
    overflow-y: auto;
  }

  /* –ù–∞–≤–∏–≥–∞—Ü–∏—è –≤ –º–æ–¥–∞–ª–∫–∞—Ö */
  .modal-nav {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
  }

  .modal-nav-btn {
    padding: 0.5rem 1rem;
    background: rgba(255, 255, 255, 0.7);
    border: 1px solid rgba(226, 232, 240, 0.8);
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.875rem;
    font-weight: 500;
    color: #475569;
  }

  .modal-nav-btn:hover {
    background: rgba(255, 255, 255, 0.9);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(15, 23, 42, 0.1);
  }

  .modal-nav-btn.active {
    background: linear-gradient(135deg, #7f9aaf 0%, #5d7283 100%);
    color: white;
    border-color: #5d7283;
  }

  .modal-back-btn {
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    font-size: 0.875rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    transition: all 0.3s ease;
    margin-right: auto;
  }

  .modal-back-btn:hover {
    background: rgba(255, 255, 255, 0.1);
  }

  /* –≠–ª–µ–º–µ–Ω—Ç—ã —Å–ø–∏—Å–∫–æ–≤ */
  .category-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
    margin-bottom: 0.75rem;
    border-radius: 16px;
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid rgba(226, 232, 240, 0.8);
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .category-item:hover {
    background: rgba(255, 255, 255, 0.95);
    transform: translateX(5px);
    box-shadow: 0 4px 12px rgba(15, 23, 42, 0.1);
  }

  .category-name {
    font-weight: 600;
    color: #0f172a;
    font-size: 1rem;
  }

  .category-count {
    background: linear-gradient(135deg, #7f9aaf 0%, #5d7283 100%);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-weight: 600;
    font-size: 0.875rem;
  }

  .book-stats-item {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 1rem 1.25rem;
    margin-bottom: 0.75rem;
    border-radius: 16px;
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid rgba(226, 232, 240, 0.8);
    transition: all 0.3s ease;
    animation: slideInLeft 0.4s ease-out;
  }

  .book-stats-item:hover {
    background: rgba(255, 255, 255, 0.95);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(15, 23, 42, 0.1);
  }

  .book-stats-info {
    flex: 1;
  }

  .book-stats-title {
    font-weight: 600;
    color: #0f172a;
    margin-bottom: 0.25rem;
    font-size: 1rem;
  }

  .book-stats-authors {
    font-size: 0.875rem;
    color: #475569;
  }

  .book-stats-meta {
    font-size: 0.75rem;
    color: #64748b;
    margin-top: 0.25rem;
  }

  /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
  .modal-content-section {
    display: none;
  }

  .modal-content-section.active {
    display: block;
    animation: fadeInUp 0.4s ease-out;
  }

  .section-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: #0f172a;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #e2e8f0;
  }

  /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
  @media (max-width: 768px) {
    .stats-compact {
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }

    .stat-item {
      padding: 0.75rem;
    }

    .stat-value {
      font-size: 1.5rem;
    }

    .action-buttons {
      grid-template-columns: 1fr;
    }

    .home-progress-stats{
      flex-direction:column;
      align-items:stretch;
      gap:.75rem;
    }
    
    .home-progress-side{
      min-width:0;
      display:flex;
      align-items:center;
      justify-content:space-between;
      text-align:left;
    }
    
    .home-progress-side.text-end{
      text-align:left!important;
    }
    
    .home-progress-value{
      font-size:1.875rem;
    }

    .stats-modal .modal-body {
      padding: 1.5rem;
    }

    .modal-nav {
      flex-direction: column;
    }

    .category-item {
      padding: 0.875rem 1.25rem;
    }
  }

  @media (max-width: 480px) {
    .stats-compact {
      grid-template-columns: 1fr;
    }

    .home-hero {
      padding: 1.5rem 1rem;
    }

    .home-hero__title {
      font-size: 1.75rem;
    }
  }

  /* Reduce motion */
  @media (prefers-reduced-motion: reduce){
    * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
</style>
{% endblock %}

{% block content %}
<!-- –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–∞–∫–∏–º –∂–µ -->
<section class="home-hero mb-5">
  <div class="row g-4 align-items-stretch">
    <div class="col-12 col-lg-7 home-hero__content">
      <p class="home-section-title mb-2">–î–æ–º–∞—à–Ω—è—è –∫–æ–ª–ª–µ–∫—Ü–∏—è</p>
      <h1 class="home-hero__title display-5 mb-3">–ú–æ—è –¥–æ–º–∞—à–Ω—è—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞</h1>
      <p class="home-hero__subtitle mb-4">–û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ –±—É–º–∞–∂–Ω—ã–µ –∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã, —Ä–∞—Å—Å—Ç–∞–≤–ª—è–π—Ç–µ –∏—Ö –ø–æ –ø–æ–ª–∫–∞–º –∏ –≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –ª—é–±–∏–º—ã–º —Å–µ—Ä–∏—è–º.</p>
      <div class="home-hero__actions mb-3">
        <a class="btn btn-light home-hero__btn" href="{% url 'book_list' %}"><i class="bi bi-plus-circle me-2"></i> –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É</a>
        <a class="btn btn-outline-light home-hero__btn" href="{% url 'profile' request.user.username %}">
          <i class="bi bi-person-circle me-1"></i>–ö –ø–æ–ª–∫–∞–º
        </a>
      </div>
    </div>

    <div class="col-12 col-lg-5 d-flex">
      <div class="home-glow-card home-progress-card w-100 h-100">
        <h2 class="h6 text-uppercase text-muted mb-3">–ö—É–ø–ª–µ–Ω–æ –ø—Ä–æ—Ç–∏–≤ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ</h2>

        <div class="home-progress-controls">
          <div class="flex-grow-1">
            <label class="form-label text-uppercase text-muted small" for="homePeriodType">–¢–∏–ø –ø–µ—Ä–∏–æ–¥–∞</label>
            <select class="form-select form-select-sm" id="homePeriodType" data-role="period-type">
              <option value="year" {% if default_period_type == "year" %}selected{% endif %}>–ì–æ–¥</option>
              <option value="month" {% if default_period_type == "month" %}selected{% endif %}>–ú–µ—Å—è—Ü</option>
            </select>
          </div>
          <div class="flex-grow-1">
            <label class="form-label text-uppercase text-muted small" for="homePeriodValue">–ü–µ—Ä–∏–æ–¥</label>
            <select class="form-select form-select-sm" id="homePeriodValue" data-role="period-value">
              {% if initial_period_options %}
                {% for option in initial_period_options %}
                  <option value="{{ option.value }}" {% if option.value == default_period_value %}selected{% endif %}>{{ option.label }}</option>
                {% endfor %}
              {% else %}
                <option value="" selected>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</option>
              {% endif %}
            </select>
          </div>
        </div>

        <div class="home-progress-stats mt-4">
          <div class="home-progress-side">
            <div class="small text-uppercase text-muted">–ö—É–ø–ª–µ–Ω–æ</div>
            <div class="home-progress-value">
              <span class="home-progress-number" data-role="period-bought-count" data-target="{{ default_period_stats.bought_count }}">0</span>
            </div>
          </div>

          <div class="home-progress-line">
            <div class="home-progress-fill-left" data-role="fill-left"></div>
            <div class="home-progress-fill-right" data-role="fill-right"></div>
            <div class="home-progress-label" data-role="period-progress-label">0%</div>
          </div>

          <div class="home-progress-side text-end">
            <div class="small text-uppercase text-muted">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ</div>
            <div class="home-progress-value">
              <span class="home-progress-number" data-role="period-read-count" data-target="{{ default_period_stats.read_count }}">0</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- –ö–æ–º–ø–∞–∫—Ç–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="home-glow-card mb-5">
  <h2 class="h6 text-uppercase text-muted mb-3">–û–±–∑–æ—Ä –±–∏–±–ª–∏–æ—Ç–µ–∫–∏</h2>
  
  <div class="stats-compact">
    <div class="stat-item" onclick="showAllBooks()">
      <div class="stat-value" data-target="{{ summary.total|default:0 }}">0</div>
      <div class="stat-label">–í—Å–µ–≥–æ –∫–Ω–∏–≥</div>
      <div class="stat-details">–≤ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ</div>
    </div>

    <div class="stat-item" onclick="showReadBooks()">
      <div class="stat-value" data-target="{{ summary.read_count|default:0 }}">0</div>
      <div class="stat-label">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ</div>
      <div class="stat-details">–∫–Ω–∏–≥</div>
    </div>

    <div class="stat-item" onclick="showGenres()">
      <div class="stat-value" data-target="{{ summary.genre_total|default:0 }}">0</div>
      <div class="stat-label">–ñ–∞–Ω—Ä–æ–≤</div>
      <div class="stat-details">–≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏</div>
    </div>

    <div class="stat-item" onclick="showSeries()">
      <div class="stat-value" data-target="{{ summary.series_total|default:0 }}">0</div>
      <div class="stat-label">–°–µ—Ä–∏–π</div>
      <div class="stat-details">–Ω–∞—á–∞—Ç–æ</div>
    </div>
  </div>

  <!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
  <div class="action-buttons">
    <a href="{% url 'book_list' %}" class="action-btn">
      <div class="action-icon"><i class="bi bi-search"></i></div>
      <div class="action-text">
        <div class="action-title">–ù–∞–π—Ç–∏ –∫–Ω–∏–≥—É</div>
        <div class="action-desc">–ü–æ–∏—Å–∫ –ø–æ –∫–∞—Ç–∞–ª–æ–≥—É</div>
      </div>
    </a>
    
    <a href="{% url 'shelves:my_shelves' %}" class="action-btn">
      <div class="action-icon"><i class="bi bi-collection"></i></div>
      <div class="action-text">
        <div class="action-title">–ú–æ–∏ –ø–æ–ª–∫–∏</div>
        <div class="action-desc">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–µ–π</div>
      </div>
    </a>
  </div>
</div>

<!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã -->
<div class="search-box">
  <div class="input-group">
    <span class="input-group-text"><i class="bi bi-search"></i></span>
    <input type="text" class="form-control" id="bookSearch" 
           placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∞–≤—Ç–æ—Ä—É –∏–ª–∏ –∂–∞–Ω—Ä—É...">
    <button class="btn btn-outline-secondary" type="button" id="clearSearch">
      <i class="bi bi-x"></i>
    </button>
  </div>
</div>

<div class="filter-chips">
  <div class="filter-chip active" data-filter="all">–í—Å–µ –∫–Ω–∏–≥–∏</div>
  <div class="filter-chip" data-filter="reading">–ß–∏—Ç–∞—é —Å–µ–π—á–∞—Å</div>
  <div class="filter-chip" data-filter="unread">–ù–µ –Ω–∞—á–∞—Ç—ã</div>
  <div class="filter-chip" data-filter="classic">–ö–ª–∞—Å—Å–∏–∫–∞</div>
  <div class="filter-chip" data-filter="modern">–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ</div>
</div>

<!-- –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ -->
{% if entries %}
  <div class="home-library-table mb-4">
    <div class="table-responsive">
      <table class="table align-middle table-hover" id="booksTable">
        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–∞–±–ª–∏—Ü—ã -->
        <thead>
          <tr>
            <th data-sort="title">–ö–Ω–∏–≥–∞</th>
            <th data-sort="format">–§–æ—Ä–º–∞—Ç</th>
            <th data-sort="status">–°—Ç–∞—Ç—É—Å</th>
            <th data-sort="location">–•—Ä–∞–Ω–µ–Ω–∏–µ</th>
            <th data-sort="classic">–ö–ª–∞—Å—Å–∏–∫–∞</th>
            <th data-sort="series">–°–µ—Ä–∏—è</th>
            <th data-sort="genres">–ñ–∞–Ω—Ä—ã</th>
            <th data-sort="acquired">–ü—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∞</th>
            <th data-sort="notes">–ó–∞–º–µ—Ç–∫–∏</th>
            <th class="text-end">–î–µ–π—Å—Ç–≤–∏—è</th>
          </tr>
        </thead>
        <tbody>
          {% default_shelf_status_map entries request.user as default_status_map %}
          {% for entry in entries %}
            {% with shelf_status=default_status_map|dict_get:entry.book.pk %}
            <tr data-book-id="{{ entry.book.pk }}"
                data-title="{{ entry.book.title|lower }}"
                data-authors="{{ entry.book.authors.all|join:', '|lower }}"
                data-genres="{% for genre in entry.custom_genres.all %}{{ genre.name|lower }} {% endfor %}"
                data-status="{{ entry.status|default:''|lower }}"
                data-classic="{% if entry.is_classic %}classic{% else %}modern{% endif %}"
                data-reading="{% if entry.is_read %}read{% elif shelf_status and shelf_status.code == 'read' %}read{% elif shelf_status and shelf_status.code == 'reading' %}reading{% else %}unread{% endif %}">
              <td data-label="–ö–Ω–∏–≥–∞" style="min-width:200px;">
                <div class="fw-semibold"><a class="text-decoration-none text-reset" href="{% url 'book_detail' entry.book.pk %}">{{ entry.book.title }}</a></div>
                <div class="small text-muted" style="color: #64748b !important;">{{ entry.book.authors.all|join:", "|default:"–ê–≤—Ç–æ—Ä –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω" }}</div>
                <div class="mt-2">
                  {% if entry.is_read %}
                    <div class="small text-muted fw-semibold" style="color: #64748b !important;">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ{% if entry.date_read %} {{ entry.date_read|date:"d.m.Y" }}{% endif %}</div>
                  {% elif shelf_status and shelf_status.code == 'read' %}
                    {% with read_date=shelf_status.added_at %}
                      <div class="small text-muted fw-semibold" style="color: #64748b !important;">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ{% if read_date %} {{ read_date|date:"d.m.Y" }}{% endif %}</div>
                    {% endwith %}
                  {% elif shelf_status and shelf_status.code == 'reading' %}
                    <div class="small text-muted fw-semibold" style="color: #64748b !important;">–ù–∞ –ø–æ–ª–∫–µ ¬´{{ shelf_status.label|default:default_reading_shelf_name|default:'–ß–∏—Ç–∞—é' }}¬ª</div>
                  {% else %}
                    <form method="post" action="{% url 'shelves:move_book_to_reading' entry.book.pk %}">
                      {% csrf_token %}
                      <input type="hidden" name="next" value="{{ request.get_full_path }}">
                      <button type="submit" class="btn btn-sm btn-outline-primary mt-1"><i class="bi bi-book-half" aria-hidden="true"></i><span>–ù–∞—á–∞—Ç—å —á–∏—Ç–∞—Ç—å</span></button>
                    </form>
                  {% endif %}
                </div>
              </td>
              <td data-label="–§–æ—Ä–º–∞—Ç">{{ entry.get_format_display }}</td>
              <td data-label="–°—Ç–∞—Ç—É—Å">{{ entry.status|default:"‚Äî" }}</td>
              <td data-label="–•—Ä–∞–Ω–µ–Ω–∏–µ">
                {% if entry.location %}{{ entry.location }}<br>{% endif %}
                {% if entry.shelf_section %}<span class="text-muted small" style="color: #64748b !important;">{{ entry.shelf_section }}</span>{% endif %}
                {% if not entry.location and not entry.shelf_section %}‚Äî{% endif %}
              </td>
              <td data-label="–ö–ª–∞—Å—Å–∏–∫–∞">{% if entry.is_classic %}<span class="badge text-bg-success">–î–∞</span>{% else %}<span class="text-muted" style="color: #64748b !important;">–ù–µ—Ç</span>{% endif %}</td>
              <td data-label="–°–µ—Ä–∏—è">{{ entry.series_name|default:"‚Äî" }}</td>
              <td data-label="–ñ–∞–Ω—Ä—ã">
                {% with entry.custom_genres.all as entry_genres %}
                  {% if entry_genres %}{% for genre in entry_genres %}<span class="tag-chip">{{ genre }}</span>{% endfor %}{% else %}‚Äî{% endif %}
                {% endwith %}
              </td>
              <td data-label="–ü—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∞">{% if entry.acquired_at %}{{ entry.acquired_at|date:"d.m.Y" }}{% else %}‚Äî{% endif %}</td>
              <td data-label="–ó–∞–º–µ—Ç–∫–∏" style="max-width:240px;white-space:pre-wrap;">{{ entry.notes|default:"‚Äî" }}</td>
              <td data-label="–î–µ–π—Å—Ç–≤–∏—è" class="text-end">
                <div class="btn-group btn-group-sm home-table-actions">
                  <a class="btn btn-outline-secondary" href="{% url 'shelves:home_library_edit' entry.shelf_item_id %}?next={{ request.get_full_path|urlencode }}"><i class="bi bi-pencil"></i></a>
                  <a class="btn btn-outline-danger" href="{% url 'shelves:remove_book_from_shelf' shelf.id entry.book.id %}?next={{ request.get_full_path|urlencode }}" title="–£–¥–∞–ª–∏—Ç—å –∏–∑ –ø–æ–ª–∫–∏" aria-label="–£–¥–∞–ª–∏—Ç—å –∫–Ω–∏–≥—É"><i class="bi bi-trash"></i></a>
                </div>
              </td>
            </tr>
            {% endwith %}
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% else %}
  <div class="alert alert-light border text-center py-5">
    <i class="bi bi-book display-1 text-muted mb-3 d-block"></i>
    <h3>–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—É—Å—Ç–∞</h3>
    <p class="text-muted">–ù–∞—á–Ω–∏—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å –∫–Ω–∏–≥–∏ –≤ —Å–≤–æ—é –∫–æ–ª–ª–µ–∫—Ü–∏—é</p>
    <a href="{% url 'book_list' %}" class="btn btn-primary mt-2">–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é –∫–Ω–∏–≥—É</a>
  </div>
{% endif %}

<!-- –ú–æ–¥–∞–ª–∫–∞ –¥–ª—è –∂–∞–Ω—Ä–æ–≤ -->
<div class="modal fade stats-modal" id="genresModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="modal-back-btn d-none" onclick="goBackToGenres()">
          <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ –∂–∞–Ω—Ä–∞–º
        </button>
        <h5 class="modal-title">üé≠ –ñ–∞–Ω—Ä—ã –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
      </div>
      <div class="modal-body">
        <!-- –°–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤ -->
        <div class="modal-content-section active" id="genresListSection">
          <div class="modal-nav">
            <button class="modal-nav-btn active" onclick="showGenresView()">–í—Å–µ –∂–∞–Ω—Ä—ã</button>
          </div>
          <div id="genresList">
            {% for genre in summary.genre_counts %}
              <div class="category-item" onclick="showGenreBooks('{{ genre.name }}')">
                <span class="category-name">{{ genre.name }}</span>
                <span class="category-count">{{ genre.total }}</span>
              </div>
            {% endfor %}
          </div>
        </div>

        <!-- –ö–Ω–∏–≥–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∂–∞–Ω—Ä–∞ -->
        <div class="modal-content-section" id="genreBooksSection">
          <h6 class="section-title" id="genreBooksTitle">–ö–Ω–∏–≥–∏ –∂–∞–Ω—Ä–∞</h6>
          <div id="genreBooksList"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ –¥–ª—è —Å–µ—Ä–∏–π -->
<div class="modal fade stats-modal" id="seriesModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="modal-back-btn d-none" onclick="goBackToSeries()">
          <i class="bi bi-arrow-left"></i> –ù–∞–∑–∞–¥ –∫ —Å–µ—Ä–∏—è–º
        </button>
        <h5 class="modal-title">üìö –°–µ—Ä–∏–∏ –∫–Ω–∏–≥</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
      </div>
      <div class="modal-body">
        <!-- –°–ø–∏—Å–æ–∫ —Å–µ—Ä–∏–π -->
        <div class="modal-content-section active" id="seriesListSection">
          <div class="modal-nav">
            <button class="modal-nav-btn active" onclick="showSeriesView()">–í—Å–µ —Å–µ—Ä–∏–∏</button>
          </div>
          <div id="seriesList">
            {% for series in summary.series_counts %}
              <div class="category-item" onclick="showSeriesBooks('{{ series.series_name }}')">
                <span class="category-name">{{ series.series_name }}</span>
                <span class="category-count">{{ series.total }}</span>
              </div>
            {% endfor %}
          </div>
        </div>

        <!-- –ö–Ω–∏–≥–∏ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å–µ—Ä–∏–∏ -->
        <div class="modal-content-section" id="seriesBooksSection">
          <h6 class="section-title" id="seriesBooksTitle">–ö–Ω–∏–≥–∏ —Å–µ—Ä–∏–∏</h6>
          <div id="seriesBooksList"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –º–æ–¥–∞–ª–∫–∏ (—á–∏—Ç–∞–Ω–Ω—ã–µ –∫–Ω–∏–≥–∏, –≤—Å–µ –∫–Ω–∏–≥–∏) -->
<div class="modal fade stats-modal" id="readBooksModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">üìñ –ü—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –∫–Ω–∏–≥–∏ ({{ summary.read_count }})</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
      </div>
      <div class="modal-body">
        <div id="readBooksList">
          {% for entry in entries %}
            {% if entry.is_read %}
              <div class="book-stats-item">
                <div class="book-stats-info">
                  <div class="book-stats-title">{{ entry.book.title }}</div>
                  <div class="book-stats-authors">{{ entry.book.authors.all|join:", "|default:"–ê–≤—Ç–æ—Ä –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω" }}</div>
                  {% if entry.date_read %}
                    <div class="book-stats-meta">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ: {{ entry.date_read|date:"d.m.Y" }}</div>
                  {% endif %}
                </div>
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade stats-modal" id="allBooksModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">üìö –í—Å–µ –∫–Ω–∏–≥–∏ ({{ summary.total }})</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
      </div>
      <div class="modal-body">
        <div id="allBooksList">
          {% for entry in entries %}
            <div class="book-stats-item">
              <div class="book-stats-info">
                <div class="book-stats-title">{{ entry.book.title }}</div>
                <div class="book-stats-authors">{{ entry.book.authors.all|join:", "|default:"–ê–≤—Ç–æ—Ä –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω" }}</div>
                <div class="book-stats-meta">
                  {% if entry.is_read %}
                    <span class="text-success">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ</span>
                  {% else %}
                    <span class="text-warning">–í –ø–ª–∞–Ω–∞—Ö</span>
                  {% endif %}
                  ‚Ä¢ {{ entry.get_format_display }}
                  {% if entry.acquired_at %}‚Ä¢ –ü—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∞: {{ entry.acquired_at|date:"d.m.Y" }}{% endif %}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
// –î–∞–Ω–Ω—ã–µ –¥–ª—è –º–æ–¥–∞–ª–æ–∫
const libraryData = {
  genres: {
    {% for genre in summary.genre_counts %}
      "{{ genre.name }}": [
        {% for entry in entries %}
          {% for genre_entry in entry.custom_genres.all %}
            {% if genre_entry.name == genre.name %}
              {
                title: "{{ entry.book.title }}",
                authors: "{{ entry.book.authors.all|join:', '|default:'–ê–≤—Ç–æ—Ä –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω' }}",
                is_read: {% if entry.is_read %}true{% else %}false{% endif %},
                format: "{{ entry.get_format_display }}",
                acquired: "{% if entry.acquired_at %}{{ entry.acquired_at|date:'d.m.Y' }}{% endif %}",
                url: "{% url 'book_detail' entry.book.pk %}"
              },
            {% endif %}
          {% endfor %}
        {% endfor %}
      ],
    {% endfor %}
  },
  series: {
    {% for series in summary.series_counts %}
      "{{ series.series_name }}": [
        {% for entry in entries %}
          {% if entry.series_name == series.series_name %}
            {
              title: "{{ entry.book.title }}",
              authors: "{{ entry.book.authors.all|join:', '|default:'–ê–≤—Ç–æ—Ä –Ω–µ–∏–∑–≤–µ—Å—Ç–µ–Ω' }}",
              is_read: {% if entry.is_read %}true{% else %}false{% endif %},
              format: "{{ entry.get_format_display }}",
              acquired: "{% if entry.acquired_at %}{{ entry.acquired_at|date:'d.m.Y' }}{% endif %}",
              url: "{% url 'book_detail' entry.book.pk %}"
            },
          {% endif %}
        {% endfor %}
      ],
    {% endfor %}
  }
};

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –≤ –º–æ–¥–∞–ª–∫–∞—Ö
function showGenreBooks(genreName) {
  const books = libraryData.genres[genreName] || [];
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
  document.getElementById('genreBooksTitle').textContent = `–ö–Ω–∏–≥–∏ –∂–∞–Ω—Ä–∞: ${genreName}`;
  
  // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–Ω–∏–≥
  const booksList = document.getElementById('genreBooksList');
  booksList.innerHTML = '';
  
  if (books.length === 0) {
    booksList.innerHTML = '<p class="text-muted text-center py-4">–ù–µ—Ç –∫–Ω–∏–≥ –≤ —ç—Ç–æ–º –∂–∞–Ω—Ä–µ</p>';
  } else {
    books.forEach(book => {
      const bookElement = document.createElement('div');
      bookElement.className = 'book-stats-item';
      bookElement.innerHTML = `
        <div class="book-stats-info">
          <div class="book-stats-title">${book.title}</div>
          <div class="book-stats-authors">${book.authors}</div>
          <div class="book-stats-meta">
            ${book.is_read ? '<span class="text-success">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ</span>' : '<span class="text-warning">–í –ø–ª–∞–Ω–∞—Ö</span>'}
            ‚Ä¢ ${book.format}
            ${book.acquired ? `‚Ä¢ –ü—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∞: ${book.acquired}` : ''}
          </div>
        </div>
      `;
      bookElement.onclick = () => window.location.href = book.url;
      booksList.appendChild(bookElement);
    });
  }
  
  // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å–µ–∫—Ü–∏–∏
  document.getElementById('genresListSection').classList.remove('active');
  document.getElementById('genreBooksSection').classList.add('active');
  document.querySelector('#genresModal .modal-back-btn').classList.remove('d-none');
}

function showSeriesBooks(seriesName) {
  const books = libraryData.series[seriesName] || [];
  
  // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
  document.getElementById('seriesBooksTitle').textContent = `–ö–Ω–∏–≥–∏ —Å–µ—Ä–∏–∏: ${seriesName}`;
  
  // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ø–∏—Å–æ–∫ –∫–Ω–∏–≥
  const booksList = document.getElementById('seriesBooksList');
  booksList.innerHTML = '';
  
  if (books.length === 0) {
    booksList.innerHTML = '<p class="text-muted text-center py-4">–ù–µ—Ç –∫–Ω–∏–≥ –≤ —ç—Ç–æ–π —Å–µ—Ä–∏–∏</p>';
  } else {
    books.forEach(book => {
      const bookElement = document.createElement('div');
      bookElement.className = 'book-stats-item';
      bookElement.innerHTML = `
        <div class="book-stats-info">
          <div class="book-stats-title">${book.title}</div>
          <div class="book-stats-authors">${book.authors}</div>
          <div class="book-stats-meta">
            ${book.is_read ? '<span class="text-success">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ</span>' : '<span class="text-warning">–í –ø–ª–∞–Ω–∞—Ö</span>'}
            ‚Ä¢ ${book.format}
            ${book.acquired ? `‚Ä¢ –ü—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω–∞: ${book.acquired}` : ''}
          </div>
        </div>
      `;
      bookElement.onclick = () => window.location.href = book.url;
      booksList.appendChild(bookElement);
    });
  }
  
  // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Å–µ–∫—Ü–∏–∏
  document.getElementById('seriesListSection').classList.remove('active');
  document.getElementById('seriesBooksSection').classList.add('active');
  document.querySelector('#seriesModal .modal-back-btn').classList.remove('d-none');
}

function goBackToGenres() {
  document.getElementById('genreBooksSection').classList.remove('active');
  document.getElementById('genresListSection').classList.add('active');
  document.querySelector('#genresModal .modal-back-btn').classList.add('d-none');
}

function goBackToSeries() {
  document.getElementById('seriesBooksSection').classList.remove('active');
  document.getElementById('seriesListSection').classList.add('active');
  document.querySelector('#seriesModal .modal-back-btn').classList.add('d-none');
}

function showGenresView() {
  goBackToGenres();
}

function showSeriesView() {
  goBackToSeries();
}

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–æ–∫
window.showReadBooks = function() {
  const modal = new bootstrap.Modal(document.getElementById('readBooksModal'));
  modal.show();
};

window.showGenres = function() {
  const modal = new bootstrap.Modal(document.getElementById('genresModal'));
  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
  goBackToGenres();
  modal.show();
};

window.showSeries = function() {
  const modal = new bootstrap.Modal(document.getElementById('seriesModal'));
  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
  goBackToSeries();
  modal.show();
};

window.showAllBooks = function() {
  const modal = new bootstrap.Modal(document.getElementById('allBooksModal'));
  modal.show();
};

// –û—Å—Ç–∞–ª—å–Ω–æ–π JavaScript –∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–∞–∫–∏–º –∂–µ
(function() {
  // –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
  function showLibraryNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = 'library-notification';
    
    const icons = { 
      info: 'info-circle', 
      success: 'check-circle', 
      warning: 'exclamation-triangle', 
      error: 'x-circle' 
    };
    
    notification.innerHTML = `
      <div class="notification-content">
        <i class="bi bi-${icons[type]} me-2"></i>
        ${message}
        <button class="notification-close">&times;</button>
      </div>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
      notification.classList.add('show');
    }, 100);
    
    const autoClose = setTimeout(() => {
      hideNotification(notification);
    }, 5000);
    
    notification.querySelector('.notification-close').addEventListener('click', () => {
      clearTimeout(autoClose);
      hideNotification(notification);
    });
  }

  function hideNotification(notification) {
    notification.classList.remove('show');
    setTimeout(() => {
      if (notification.parentNode) {
        notification.parentNode.removeChild(notification);
      }
    }, 500);
  }

  // –ê–Ω–∏–º–∞—Ü–∏—è —á–∏—Å–µ–ª
  function animateNumber(element, targetValue, duration = 1000) {
    const startValue = parseInt(element.textContent) || 0;
    const startTime = performance.now();
    
    function updateNumber(currentTime) {
      const elapsed = currentTime - startTime;
      const progress = Math.min(elapsed / duration, 1);
      
      const easeOutQuart = 1 - Math.pow(1 - progress, 4);
      const currentValue = Math.floor(startValue + (targetValue - startValue) * easeOutQuart);
      
      element.textContent = currentValue.toLocaleString();
      
      if (progress < 1) {
        requestAnimationFrame(updateNumber);
      } else {
        element.textContent = targetValue.toLocaleString();
      }
    }
    
    requestAnimationFrame(updateNumber);
  }

  // –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö –∞–Ω–∏–º–∞—Ü–∏–π –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
  function initializeAnimations() {
    document.querySelectorAll('.stat-value[data-target]').forEach(stat => {
      const target = parseInt(stat.getAttribute('data-target'));
      if (!isNaN(target)) {
        setTimeout(() => {
          animateNumber(stat, target);
        }, 800);
      }
    });

    setTimeout(() => {
      const boughtCount = parseInt("{{ default_period_stats.bought_count }}") || 0;
      const readCount = parseInt("{{ default_period_stats.read_count }}") || 0;
      const total = boughtCount + readCount;
      
      if (total > 0) {
        const boughtPercent = (boughtCount / total) * 100;
        const readPercent = 100 - boughtPercent;
        
        const fillLeft = document.querySelector('[data-role="fill-left"]');
        const fillRight = document.querySelector('[data-role="fill-right"]');
        const label = document.querySelector('[data-role="period-progress-label"]');
        
        if (fillLeft && fillRight && label) {
          fillLeft.style.width = boughtPercent + '%';
          fillRight.style.width = readPercent + '%';
          label.textContent = Math.round(boughtPercent) + '% / ' + Math.round(readPercent) + '%';
        }
      }
      
      const boughtNumber = document.querySelector('[data-role="period-bought-count"]');
      const readNumber = document.querySelector('[data-role="period-read-count"]');
      
      if (boughtNumber) {
        const targetBought = parseInt(boughtNumber.getAttribute('data-target')) || 0;
        animateNumber(boughtNumber, targetBought, 1200);
      }
      
      if (readNumber) {
        const targetRead = parseInt(readNumber.getAttribute('data-target')) || 0;
        animateNumber(readNumber, targetRead, 1200);
      }
    }, 1000);

    setTimeout(() => {
      showLibraryNotification('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≤–∞—à—É –±–∏–±–ª–∏–æ—Ç–µ–∫—É! –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.', 'info');
    }, 2000);
  }

  // –ü–æ–∏—Å–∫ –∫–Ω–∏–≥
  function initializeSearch() {
    const searchInput = document.getElementById('bookSearch');
    const clearSearch = document.getElementById('clearSearch');
    
    if (searchInput) {
      searchInput.addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase().trim();
        const rows = document.querySelectorAll('#booksTable tbody tr');
        let visibleCount = 0;
        
        rows.forEach(row => {
          const title = row.dataset.title || '';
          const authors = row.dataset.authors || '';
          const genres = row.dataset.genres || '';
          const searchText = title + ' ' + authors + ' ' + genres;
          const isVisible = searchText.includes(searchTerm);
          
          row.style.display = isVisible ? '' : 'none';
          if (isVisible) visibleCount++;
        });
        
        if (searchTerm && visibleCount === 0) {
          showLibraryNotification('–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ', 'warning');
        }
      });
      
      clearSearch.addEventListener('click', function() {
        searchInput.value = '';
        const rows = document.querySelectorAll('#booksTable tbody tr');
        rows.forEach(row => row.style.display = '');
        showLibraryNotification('–ü–æ–∏—Å–∫ –æ—á–∏—â–µ–Ω', 'info');
      });
    }
  }

  // –§–∏–ª—å—Ç—Ä—ã
  function initializeFilters() {
    const filterChips = document.querySelectorAll('.filter-chip');
    
    filterChips.forEach(chip => {
      chip.addEventListener('click', function() {
        const filter = this.dataset.filter;
        
        filterChips.forEach(c => c.classList.remove('active'));
        this.classList.add('active');
        
        const rows = document.querySelectorAll('#booksTable tbody tr');
        let visibleCount = 0;
        
        rows.forEach(row => {
          let matchesFilter = true;
          
          switch (filter) {
            case 'reading':
              matchesFilter = row.dataset.reading === 'reading';
              break;
            case 'unread':
              matchesFilter = row.dataset.reading === 'unread';
              break;
            case 'classic':
              matchesFilter = row.dataset.classic === 'classic';
              break;
            case 'modern':
              matchesFilter = row.dataset.classic === 'modern';
              break;
            default:
              matchesFilter = true;
          }
          
          row.style.display = matchesFilter ? '' : 'none';
          if (matchesFilter) visibleCount++;
        });
        
        showLibraryNotification(`–ü–æ–∫–∞–∑–∞–Ω–æ: ${visibleCount} –∫–Ω–∏–≥`, 'info');
      });
    });
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  document.addEventListener('DOMContentLoaded', function() {
    initializeAnimations();
    initializeSearch();
    initializeFilters();
  });

})();
</script>
{% endblock %}