{% extends "base.html" %}
{% block title %}Мои полки{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h5 mb-0">Мои полки</h1>
  <a class="btn btn-outline-primary btn-sm" href="{% url 'shelf_create' %}">Создать полку</a>
</div>

{% if shelves %}
  <div class="accordion" id="myShelvesAcc">
    {% for shelf in shelves %}
      <div class="accordion-item">
        <h2 class="accordion-header" id="head{{ shelf.id }}">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#body{{ shelf.id }}">
            {{ shelf.name }}
            {% if shelf.is_default %}<span class="badge text-bg-light ms-2">системная</span>{% endif %}
            {% if not shelf.is_public %}<span class="badge text-bg-secondary ms-2">приватная</span>{% endif %}
          </button>
        </h2>
        <div id="body{{ shelf.id }}" class="accordion-collapse collapse" data-bs-parent="#myShelvesAcc">
          <div class="accordion-body">
            {% if shelf.items.all %}
              <div class="row g-3">
                {% for it in shelf.items.all %}
                  <div class="col-12 col-md-6 col-lg-4">
                    <div class="card h-100 shadow-sm border-0">
                      {% if it.book.cover %}
                        <img src="{{ it.book.cover.url }}" class="card-img-top" style="height:180px;object-fit:cover" alt="">
                      {% endif %}
                      <div class="card-body">
                        <h6 class="card-title mb-1">
                          <a class="text-decoration-none" href="{% url 'book_detail' it.book.pk %}">{{ it.book.title }}</a>
                        </h6>
                        <div class="small text-muted">{{ it.book.authors.all|join:", " }}</div>
                        <div class="mt-2">
                          <a class="btn btn-sm btn-outline-danger"
                             href="{% url 'remove_book_from_shelf' shelf.id it.book.id %}">
                            Удалить
                          </a>
                        </div>
                      </div>
                    </div>
                  </div>
                {% endfor %}
              </div>
            {% else %}
              <div class="text-muted">Пока нет книг.</div>
            {% endif %}
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="alert alert-light border">У вас пока нет полок.</div>
{% endif %}
{% endblock %}
