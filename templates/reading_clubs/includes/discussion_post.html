<article class="discussion-post{% if level %} discussion-post--nested{% endif %}" id="post-{{ post.pk }}">
  <div class="d-flex justify-content-between mb-2">
    <div class="discussion-post__author">
      <a class="discussion-post__author-link" href="{% url 'profile' post.author.username %}">{{ post.author.get_full_name|default:post.author.username }}</a>
    </div>
    <div class="discussion-post__timestamp">{{ post.created_at|date:"d E Y H:i" }}</div>
  </div>

  {% if post.parent %}
    <div class="discussion-post__reply-meta">
      <i class="bi bi-arrow-return-right me-1"></i>
      В ответ <a class="discussion-link" href="#post-{{ post.parent.pk }}">{{ post.parent.author.get_full_name|default:post.parent.author.username }}</a>
    </div>
  {% endif %}

  <p class="mb-0 discussion-post__content">{{ post.content|linebreaksbr }}</p>

  {% if can_post %}
    <div class="mt-2">
      <a class="discussion-post__reply-link discussion-link"
         href="{% url 'reading_clubs:topic_detail' reading.slug topic.pk %}?reply_to={{ post.pk }}#reply-form">
        <i class="bi bi-reply me-1"></i> Ответить
      </a>
    </div>
  {% endif %}
</article>

{% if post.thread_children %}
  <div class="discussion-post__children">
    {% for child in post.thread_children %}
      {% include "reading_clubs/includes/discussion_post.html" with post=child level=level|add:1 can_post=can_post reading=reading topic=topic %}
    {% endfor %}
  </div>
{% endif %}
