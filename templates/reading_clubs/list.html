{% extends "base.html" %}
{% load static %}

{% block title %}–°–æ–≤–º–µ—Å—Ç–Ω—ã–µ —á—Ç–µ–Ω–∏—è ¬∑ ReadTogether{% endblock %}

{% block extra_css %}
  {{ block.super }}
  <link rel="stylesheet" href="{% static 'reading_clubs/style.css' %}">
{% endblock %}

{% block content %}
  <div class="reading-hero">
    <h1 class="display-5 mb-3">–°–æ–≤–º–µ—Å—Ç–Ω—ã–µ —á—Ç–µ–Ω–∏—è</h1>
    <p class="lead mb-0">–ù–∞—Ö–æ–¥–∏—Ç–µ –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤, –æ–±—Å—É–∂–¥–∞–π—Ç–µ –ª—é–±–∏–º—ã–µ –∫–Ω–∏–≥–∏ –∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è–π—Ç–µ—Å—å –Ω–æ–≤—ã–º–∏ –∏—Å—Ç–æ—Ä–∏—è–º–∏ –≤–º–µ—Å—Ç–µ.</p>
  </div>

  {% if user.is_authenticated %}
    <div class="mb-4">
      <a class="btn btn-reading" href="{% url 'reading_clubs:create' %}">
        <i class="bi bi-journal-plus me-1"></i> –°–æ–∑–¥–∞—Ç—å —Å–æ–≤–º–µ—Å—Ç–Ω–æ–µ —á—Ç–µ–Ω–∏–µ
      </a>
    </div>
  {% endif %}

  <div class="reading-groups">
    {% for grouping in groupings %}
      <section id="{{ grouping.slug }}" class="reading-group mb-5">
        <div class="d-flex justify-content-between align-items-start flex-column flex-md-row mb-3">
          <div>
            <h2 class="h4 reading-group__title mb-1">{{ grouping.title }}</h2>
            <p class="text-muted mb-0">{{ grouping.description }}</p>
          </div>
          <span class="badge text-bg-light mt-3 mt-md-0">{{ grouping.queryset|length }} —à—Ç.</span>
        </div>

        {% if grouping.queryset %}
          <div class="row g-3">
            {% for club in grouping.queryset %}
              <div class="col-12 col-md-6 col-xl-4">
                <article class="reading-card reading-card--compact h-100">
                  <div class="reading-card__cover mb-3 mb-md-0">
                    {% with cover_url=club.book.get_cover_url %}
                      {% if cover_url %}
                        <img class="reading-card__cover-image" src="{{ cover_url }}" alt="–û–±–ª–æ–∂–∫–∞ –∫–Ω–∏–≥–∏ {{ club.book.title }}">
                      {% else %}
                        <div class="reading-card__cover-placeholder" aria-hidden="true">üìò</div>
                      {% endif %}
                    {% endwith %}
                  </div>
                  <div class="reading-card__body">
                    <div class="reading-card__title mb-2">
                      <a href="{{ club.get_absolute_url }}">{{ club.title }}</a>
                    </div>
                    <div class="reading-card__meta mb-2">
                      <div class="mb-1"><i class="bi bi-book me-1"></i> {{ club.book.title }}</div>
                      <div class="small text-muted">
                        –ù–∞—á–∞–ª–æ: {{ club.start_date|date:"d E Y" }}{% if club.end_date %} ¬∑ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ: {{ club.end_date|date:"d E Y" }}{% endif %}
                      </div>
                    </div>
                    <p class="text-muted small mb-3">{{ club.description|truncatewords:24 }}</p>
                    <div class="reading-card__footer text-muted">
                      <span><i class="bi bi-people me-1"></i> {{ club.approved_participant_count }} —É—á–∞—Å—Ç–Ω.</span>
                      <span><i class="bi bi-chat-left-text me-1"></i> {{ club.message_count }} —Å–æ–æ–±—â–µ–Ω–∏–π</span>
                    </div>
                  </div>
                </article>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted mb-0">–ü–æ–∫–∞ –ø—É—Å—Ç–æ. –°—Ç–∞–Ω—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–∫–∏–µ —á—Ç–µ–Ω–∏—è.</p>
        {% endif %}
      </section>
    {% endfor %}
  </div>
{% endblock %}