{% load shelf_extras %}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <title>–ß–∏—Ç–∞—Ç–µ–ª—å—Å–∫–∏–π –º–µ—Å—è—Ü {{ month_name }} {{ calendar_year }}</title>
  <style>
    :root {
      --accent: #b57464;
      --accent-soft: rgba(181, 116, 100, 0.12);
      --accent-strong: #8c4f42;
      --ink: #2d2a32;
      --muted: #6f6a72;
      --surface: #fff9f5;
      --surface-alt: #fff2ea;
      --line: rgba(181, 116, 100, 0.18);
      --shadow: 0 12px 32px rgba(47, 34, 20, 0.08);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    @page {
      size: A4;
      margin: 0;
    }

    body {
      margin: 0;
      padding: 0;
      background: #f4ede7;
      color: var(--ink);
      font-family: 'Inter', 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
      font-size: 12px;
      line-height: 1.45;
    }

    .page {
      width: 210mm;
      height: 297mm;
      background: var(--surface);
      margin: 0 auto;
      padding: 18mm 16mm;
      position: relative;
      overflow: hidden;
      page-break-after: always;
    }

    .page:last-child {
      page-break-after: auto;
    }

    .page::before,
    .page::after {
      content: "";
      position: absolute;
      width: 160mm;
      height: 160mm;
      background: radial-gradient(circle, rgba(181, 116, 100, 0.12) 0%, transparent 70%);
      z-index: 0;
      pointer-events: none;
    }

    .page::before {
      top: -80mm;
      left: -60mm;
      transform: rotate(12deg);
    }

    .page::after {
      bottom: -80mm;
      right: -60mm;
      transform: rotate(-8deg);
    }

    .content {
      position: relative;
      z-index: 1;
      height: 100%;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    header.print-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(181, 116, 100, 0.12));
      border: 1px solid var(--line);
      border-radius: 18px;
      padding: 18px 22px;
      box-shadow: var(--shadow);
    }

    .profile-intro {
      display: flex;
      align-items: center;
      gap: 18px;
    }

    .avatar {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: var(--surface-alt);
      border: 2px solid rgba(255, 255, 255, 0.6);
      box-shadow: 0 8px 18px rgba(181, 116, 100, 0.22);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Playfair Display', Georgia, 'Times New Roman', serif;
      font-size: 22px;
      color: var(--accent-strong);
      overflow: hidden;
    }

    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .profile-meta h1 {
      font-family: 'Playfair Display', Georgia, 'Times New Roman', serif;
      font-size: 22px;
      font-weight: 600;
      margin-bottom: 4px;
      color: var(--accent-strong);
    }

    .profile-meta p {
      margin: 0;
      font-size: 12px;
      color: var(--muted);
    }

    .month-badge {
      text-align: right;
    }

    .month-badge .title {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 18px;
      color: var(--accent-strong);
      letter-spacing: 0.02em;
    }

    .month-badge .subtitle {
      font-size: 11px;
      color: var(--muted);
    }

    .section {
      background: rgba(255, 255, 255, 0.92);
      border: 1px solid rgba(0, 0, 0, 0.04);
      border-radius: 16px;
      padding: 16px 18px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.04);
    }

    .section h2 {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 16px;
      color: var(--accent-strong);
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }

    .section h2::before {
      content: '';
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: linear-gradient(135deg, rgba(181, 116, 100, 0.85), rgba(248, 219, 206, 0.9));
      box-shadow: 0 0 0 2px rgba(181, 116, 100, 0.12);
    }

    .summary-grid {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      gap: 10px;
    }

    .summary-card {
      background: var(--surface-alt);
      border-radius: 14px;
      padding: 12px;
      border: 1px solid var(--line);
      display: flex;
      flex-direction: column;
      gap: 4px;
      text-align: center;
    }

    .summary-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
    }

    .summary-value {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 16px;
      color: var(--accent-strong);
    }

    .calendar-grid {
      width: 100%;
      border-collapse: separate;
      border-spacing: 6px;
      font-size: 11px;
    }

    .calendar-grid thead th {
      text-align: center;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      padding-bottom: 6px;
    }

    .calendar-day {
      background: rgba(255, 255, 255, 0.85);
      border-radius: 12px;
      border: 1px solid rgba(0, 0, 0, 0.04);
      min-height: 52px;
      padding: 6px 8px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .calendar-day.inactive {
      opacity: 0.5;
    }

    .calendar-day .date {
      font-size: 11px;
      font-weight: 600;
      color: var(--accent-strong);
    }

    .calendar-day .badge {
      display: inline-block;
      padding: 1px 6px;
      border-radius: 999px;
      background: rgba(181, 116, 100, 0.12);
      color: var(--accent-strong);
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .calendar-day .metrics {
      margin-top: auto;
      font-size: 9px;
      color: var(--muted);
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    /* –§–ò–ö–°–ò–†–û–í–ê–ù–ù–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ì–†–ê–§–ò–ö–û–í */
    .tracker-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }

    .tracker-card {
      background: rgba(255, 255, 255, 0.8);
      border: 1px solid rgba(0, 0, 0, 0.05);
      border-radius: 12px;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    /* –ü—Ä–æ—Å—Ç—ã–µ –±–∞—Ä—ã –≤–º–µ—Å—Ç–æ sparkline */
    .simple-bars {
      display: flex;
      align-items: end;
      gap: 2px;
      height: 48px;
      padding: 4px 0;
    }

    .simple-bar {
      flex: 1;
      background: linear-gradient(180deg, rgba(181, 116, 100, 0.85), rgba(181, 116, 100, 0.35));
      border-radius: 2px 2px 0 0;
      min-height: 3px;
    }

    .audio-bar {
      background: linear-gradient(180deg, rgba(130, 98, 160, 0.85), rgba(196, 173, 220, 0.45));
    }

    /* –•–∞–±–±–∏—Ç-—Ç—Ä–µ–∫–µ—Ä —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≤—ã—Å–æ—Ç–æ–π */
    .habit-tracker {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
      height: 80px;
    }

    .habit-cell {
      position: relative;
      border-radius: 6px;
      border: 1px solid rgba(0, 0, 0, 0.08);
      background: rgba(255, 255, 255, 0.65);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 9px;
      color: var(--muted);
    }

    .habit-cell.active {
      background: linear-gradient(135deg, rgba(181, 116, 100, 0.55), rgba(181, 116, 100, 0.8));
      color: white;
      border-color: rgba(181, 116, 100, 0.3);
    }

    .completed-books {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }

    .book-card {
      background: rgba(255, 255, 255, 0.85);
      border-radius: 14px;
      border: 1px solid rgba(0, 0, 0, 0.05);
      padding: 10px;
      display: grid;
      grid-template-columns: 52px 1fr;
      gap: 10px;
      min-height: 110px;
    }

    .book-cover {
      width: 52px;
      height: 78px;
      border-radius: 8px;
      overflow: hidden;
      background: rgba(255, 255, 255, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 9px;
      color: var(--muted);
      text-align: center;
      padding: 6px;
    }

    .book-cover img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .book-info h3 {
      font-size: 12px;
      margin-bottom: 4px;
      color: var(--accent-strong);
    }

    .book-info .authors {
      font-size: 10px;
      color: var(--muted);
      margin-bottom: 6px;
    }

    .book-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .book-tag {
      background: rgba(181, 116, 100, 0.12);
      border-radius: 999px;
      padding: 2px 8px;
      font-size: 9px;
      color: var(--accent-strong);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .charts-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      min-height: 360px;
    }

    .chart-image {
      width: calc(210mm * 0.45);
      max-width: 100%;
      max-height: calc(297mm * 0.45);
      height: auto;
      object-fit: contain;
      display: block;
      margin: 0 auto;
      border-radius: 14px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    }

    .section h2 {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 20px; /* –£–≤–µ–ª–∏—á–∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü–∏–∏ */
      color: var(--accent-strong);
      margin-bottom: 16px;
    }

    .highlights {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    .highlight-card {
      background: rgba(255, 255, 255, 0.85);
      border-radius: 14px;
      border: 1px solid rgba(0, 0, 0, 0.04);
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      min-height: 110px;
    }

    .highlight-title {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 13px;
      color: var(--accent-strong);
    }

    .highlight-body {
      font-size: 11px;
      color: var(--muted);
      line-height: 1.5;
    }

    ul.simple-list {
      list-style: none;
      display: flex;
      flex-direction: column;
      gap: 4px;
      padding-left: 0;
      margin: 0;
      font-size: 11px;
    }

    .empty-note {
      font-style: italic;
      color: var(--muted);
      font-size: 11px;
    }
  </style>
</head>
<body>
  <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 1: –®–∞–ø–∫–∞ –∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—å -->
  <div class="page">
    <div class="content">
      <header class="print-header">
        <div class="profile-intro">
          <div class="avatar">
            {% if avatar_url %}
              <img src="{{ avatar_url }}" alt="–ê–≤–∞—Ç–∞—Ä {{ user.username }}">
            {% else %}
              {{ user.username|first|upper }}
            {% endif %}
          </div>
          <div class="profile-meta">
            <h1>–ß–∏—Ç–∞—Ç–µ–ª—å—Å–∫–∏–π –¥–Ω–µ–≤–Ω–∏–∫ {{ user.username }} –≤ –ö–∞–ª–µ–π–¥–æ—Å–∫–æ–ø –ö–Ω–∏–≥</h1>
            <p>–ú–µ—Å—è—Ü: {{ month_name }} {{ calendar_year }} ¬∑ —É—é—Ç–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</p>
          </div>
        </div>
        <div class="month-badge">
          <div class="title">{{ month_name }} {{ calendar_year }}</div>
          <div class="subtitle">{{ stats_period.start|date:"d.m.Y" }} ‚Äî {{ stats_period.end|date:"d.m.Y" }}</div>
        </div>
      </header>

      <section class="section">
        <h2>–ú–µ—Å—è—Ü –≤ —Ü–∏—Ñ—Ä–∞—Ö</h2>
        <div class="summary-grid">
          <div class="summary-card">
            <div class="summary-label">–°—Ç—Ä–∞–Ω–∏—Ü</div>
            <div class="summary-value">{{ month_overview.pages_total|default:0 }}</div>
          </div>
          <div class="summary-card">
            <div class="summary-label">–ö–Ω–∏–≥ –∑–∞–≤–µ—Ä—à–µ–Ω–æ</div>
            <div class="summary-value">{{ month_overview.books_count|default:0 }}</div>
          </div>
          <div class="summary-card">
            <div class="summary-label">–î–Ω–µ–π —Å –∫–Ω–∏–≥–æ–π</div>
            <div class="summary-value">{{ month_overview.reading_days|default:0 }}</div>
          </div>
          <div class="summary-card">
            <div class="summary-label">–°—Ç—Ä–∞–Ω–∏—Ü –≤ –¥–µ–Ω—å</div>
            <div class="summary-value">{% if month_overview.avg_pages %}{{ month_overview.avg_pages|floatformat:1 }}{% else %}‚Äî{% endif %}</div>
          </div>
          <div class="summary-card">
            <div class="summary-label">–ü—Ä–æ—Å–ª—É—à–∞–Ω–æ –∞—É–¥–∏–æ</div>
            <div class="summary-value">{% if stats.audio_total_display %}{{ stats.audio_total_display }}{% else %}‚Äî{% endif %}</div>
          </div>
          <div class="summary-card">
            <div class="summary-label">–ë–µ—Å–ø—Ä–µ—Ä—ã–≤–Ω–æ</div>
            <div class="summary-value">{% if highlights.best_streak %}{{ highlights.best_streak }} –¥–Ω.{% else %}üåô{% endif %}</div>
          </div>
        </div>
      </section>

      <section class="section">
        <h2>–ö–∞–ª–µ–Ω–¥–∞—Ä—å —É—é—Ç–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è</h2>
        <table class="calendar-grid">
          <thead>
            <tr>
              {% for weekday in weekday_labels %}
                <th scope="col">{{ weekday }}</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody>
            {% for week in calendar.weeks %}
              <tr>
                {% for day in week %}
                  <td>
                    <div class="calendar-day{% if not day.in_month %} inactive{% endif %}">
                      <div class="date">{{ day.date.day }}</div>
                      {% if day.books_count and day.in_month %}
                        <span class="badge">{{ day.books_count }} {{ day.books_count|ru_pluralize:"–∫–Ω–∏–≥–∞,–∫–Ω–∏–≥–∏,–∫–Ω–∏–≥" }}</span>
                      {% elif day.pages_total and day.in_month %}
                        <span class="badge">{{ day.pages_total }} —Å—Ç—Ä.</span>
                      {% endif %}
                      <div class="metrics">
                        {% if day.pages_total and day.in_month %}<span>{{ day.pages_total }} —Å—Ç—Ä.</span>{% endif %}
                        {% if day.audio_minutes and day.in_month %}<span>{{ day.audio_minutes }} –º–∏–Ω.</span>{% endif %}
                        {% if day.reading_sessions and day.in_month %}<span>{{ day.reading_sessions }} —Å–µ—Å—Å.</span>{% endif %}
                      </div>
                    </div>
                  </td>
                {% endfor %}
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </section>
    </div>
  </div>

  <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 2: –¢—Ä–µ–∫–µ—Ä—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –∏ –ø–µ—Ä–≤—ã–µ 12 –∫–Ω–∏–≥ -->
  <div class="page">
    <div class="content">
      <section class="section">
        <h2>–¢—Ä–µ–∫–µ—Ä—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è</h2>
        <div class="tracker-grid">
          <div class="tracker-card">
            <div class="summary-label">–ü—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</div>
            <div class="simple-bars">
              {% for day in daily_summary %}
                <div class="simple-bar" style="height: {{ day.pages_percent }}%;"></div>
              {% endfor %}
            </div>
            <div class="summary-label">–ö–∞–∂–¥–∞—è –∫–æ–ª–æ–Ω–∫–∞ ‚Äî –¥–µ–Ω—å –º–µ—Å—è—Ü–∞</div>
          </div>
          <div class="tracker-card">
            <div class="summary-label">–ê—É–¥–∏–æ —Ä–∏—Ç—É–∞–ª—ã</div>
            <div class="simple-bars">
              {% for day in daily_summary %}
                <div class="simple-bar audio-bar" style="height: {{ day.audio_percent }}%;"></div>
              {% endfor %}
            </div>
            <div class="summary-label">–í—Å–µ–≥–æ: {% if total_audio_label %}{{ total_audio_label }}{% else %}‚Äî{% endif %}</div>
            <div class="summary-label">–£—á—ë—Ç: {% if stats.audio_tracked_display %}{{ stats.audio_tracked_display }}{% else %}‚Äî{% endif %}</div>
          </div>
          <div class="tracker-card">
            <div class="summary-label">–ê–∫—Ç–∏–≤–Ω—ã–µ –¥–Ω–∏</div>
            <div class="habit-tracker">
              {% for day in daily_summary %}
                <div class="habit-cell{% if day.has_activity %} active{% endif %}">
                  {{ day.date.day }}
                </div>
              {% endfor %}
            </div>
            <div class="summary-label">{{ month_overview.reading_days|default:0 }} –∏–∑ {{ daily_summary|length }} –¥–Ω–µ–π —Å–æ–≥—Ä–µ—Ç—ã —á—Ç–µ–Ω–∏–µ–º</div>
          </div>
        </div>
      </section>

      <section class="section">
        <h2>–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∫–Ω–∏–≥–∏</h2>
        {% if completed_books %}
          <div class="completed-books">
            {% for book in completed_books|slice:":12" %}
              <div class="book-card">
                <div class="book-cover">
                  {% if book.cover_url %}
                    <img src="{{ book.cover_url }}" alt="–û–±–ª–æ–∂–∫–∞ {{ book.title }}">
                  {% else %}
                    –ù–µ—Ç –æ–±–ª–æ–∂–∫–∏
                  {% endif %}
                </div>
                <div class="book-info">
                  <h3>{{ book.title }}</h3>
                  <div class="authors">{{ book.authors|join:", "|default:"–ê–≤—Ç–æ—Ä –Ω–µ —É–∫–∞–∑–∞–Ω" }}</div>
                  <div class="book-tags">
                    {% if book.format %}<span class="book-tag">{{ book.format }}</span>{% endif %}
                    {% if book.has_review %}<span class="book-tag">–ï—Å—Ç—å –æ—Ç–∑—ã–≤</span>{% endif %}
                    {% for genre in book.genres|slice:":2" %}
                      <span class="book-tag">{{ genre }}</span>
                    {% endfor %}
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
          {% if completed_books|length > 12 %}
            <p style="text-align: center; color: var(--muted); font-size: 11px; margin-top: 10px;">
              –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ...
            </p>
          {% endif %}
        {% else %}
          <p class="empty-note">–í —ç—Ç–æ–º –º–µ—Å—è—Ü–µ –µ—â—ë –Ω–µ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∫–Ω–∏–≥ ‚Äî –∑–∞—Ç–æ –≤–ø–µ—Ä–µ–¥–∏ –Ω–æ–≤—ã–µ –∏—Å—Ç–æ—Ä–∏–∏.</p>
        {% endif %}
      </section>
    </div>
  </div>

  <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ 3: –û—Å—Ç–∞–≤—à–∏–µ—Å—è –∫–Ω–∏–≥–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å) –∏ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã -->
  <div class="page">
    <div class="content">
      {% if completed_books|length > 12 %}
        <section class="section">
          <h2>–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∫–Ω–∏–≥–∏ (–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ)</h2>
          <div class="completed-books">
            {% for book in completed_books|slice:"12:" %}
              <div class="book-card">
                <div class="book-cover">
                  {% if book.cover_url %}
                    <img src="{{ book.cover_url }}" alt="–û–±–ª–æ–∂–∫–∞ {{ book.title }}">
                  {% else %}
                    –ù–µ—Ç –æ–±–ª–æ–∂–∫–∏
                  {% endif %}
                </div>
                <div class="book-info">
                  <h3>{{ book.title }}</h3>
                  <div class="authors">{{ book.authors|join:", "|default:"–ê–≤—Ç–æ—Ä –Ω–µ —É–∫–∞–∑–∞–Ω" }}</div>
                  <div class="book-tags">
                    {% if book.format %}<span class="book-tag">{{ book.format }}</span>{% endif %}
                    {% if book.has_review %}<span class="book-tag">–ï—Å—Ç—å –æ—Ç–∑—ã–≤</span>{% endif %}
                    {% for genre in book.genres|slice:":2" %}
                      <span class="book-tag">{{ genre }}</span>
                    {% endfor %}
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        </section>
      {% endif %}

      <section class="section">
        <h2>–î–∏–∞–≥—Ä–∞–º–º—ã –º–µ—Å—è—Ü–∞</h2>
        <div class="charts-grid">
          <div>
            <h3 class="summary-label" style="margin-bottom:6px;">–õ—é–±–∏–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã</h3>
            {% if chart_images.formats %}
              <img src="data:image/png;base64,{{ chart_images.formats }}" alt="–õ—é–±–∏–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã" class="chart-image">
            {% elif format_breakdown %}
              <ul class="simple-list" style="margin-top: 6px;">
                {% for item in format_breakdown %}
                  <li>{{ item.label }} ‚Äî {{ item.percent }}%</li>
                {% endfor %}
              </ul>
            {% else %}
              <p class="empty-note">–§–æ—Ä–º–∞—Ç—ã –ø–æ–∫–∞ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã.</p>
            {% endif %}
          </div>
          <div>
            <h3 class="summary-label" style="margin-bottom:6px;">–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ –∂–∞–Ω—Ä–∞–º</h3>
            {% if chart_images.genres %}
              <img src="data:image/png;base64,{{ chart_images.genres }}" alt="–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ –∂–∞–Ω—Ä–∞–º" class="chart-image">
            {% elif genre_breakdown %}
              <ul class="simple-list" style="margin-top: 6px;">
                {% for item in genre_breakdown %}
                  <li>{{ item.label }} ‚Äî {{ item.value }} ({{ item.percent }}%)</li>
                {% endfor %}
              </ul>
            {% else %}
              <p class="empty-note">–ñ–∞–Ω—Ä–æ–≤—ã–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –≤–ø–µ—Ä–µ–¥–∏.</p>
            {% endif %}
          </div>
        </div>
      </section>

      <section class="section">
        <h2>–¢—ë–ø–ª—ã–µ –º–æ–º–µ–Ω—Ç—ã</h2>
        <div class="highlights">
          <div class="highlight-card">
            <div class="highlight-title">–ß–∏—Ç–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø–æ–±–µ–¥—ã</div>
            <div class="highlight-body">
              {% if highlights.best_streak %}
                –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–µ—Ä–∏—è ‚Äî {{ highlights.best_streak }} {{ highlights.best_streak|ru_pluralize:"–¥–µ–Ω—å,–¥–Ω—è,–¥–Ω–µ–π" }} –ø–æ–¥—Ä—è–¥.
              {% else %}
                –°–µ—Ä–∏—è –µ—â—ë –≤–ø–µ—Ä–µ–¥–∏ ‚Äî —Å–∞–º–æ–µ –≤—Ä–µ–º—è –Ω–∞—á–∞—Ç—å –Ω–æ–≤—É—é —Ç—Ä–∞–¥–∏—Ü–∏—é.
              {% endif %}
              {% if highlights.longest_break %}
                <br>–ù–µ–±–æ–ª—å—à–æ–π –æ—Ç–¥—ã—Ö –¥–ª–∏–ª—Å—è {{ highlights.longest_break }} {{ highlights.longest_break|ru_pluralize:"–¥–µ–Ω—å,–¥–Ω—è,–¥–Ω–µ–π" }} ‚Äî –∏ —Å–Ω–æ–≤–∞ –≤ –ø—É—Ç—å!
              {% endif %}
            </div>
          </div>
          <div class="highlight-card">
            <div class="highlight-title">–õ—É—á—à–∏–µ –¥–Ω–∏</div>
            <div class="highlight-body">
              {% if top_activity_days %}
                <ul class="simple-list">
                  {% for day in top_activity_days %}
                    <li><strong>{{ day.date|date:"d E" }}</strong>: {{ day.pages }} —Å—Ç—Ä., {{ day.books_count }} {{ day.books_count|ru_pluralize:"–∫–Ω–∏–≥–∞,–∫–Ω–∏–≥–∏,–∫–Ω–∏–≥" }}{% if day.audio_minutes %}, {{ day.audio_minutes }} –º–∏–Ω. –∞—É–¥–∏–æ{% endif %}</li>
                  {% endfor %}
                </ul>
              {% else %}
                <p class="empty-note">–¢–∏—Ö–∏–π –º–µ—Å—è—Ü –±–µ–∑ —Ä–µ–∫–æ—Ä–¥–æ–≤ ‚Äî –∏ —ç—Ç–æ —Ç–æ–∂–µ —É—é—Ç–Ω–æ.</p>
              {% endif %}
            </div>
          </div>
          <div class="highlight-card">
            <div class="highlight-title">–õ—é–±–∏–º—ã–µ –∞–≤—Ç–æ—Ä—ã</div>
            <div class="highlight-body">
              {% if top_authors %}
                <ul class="simple-list">
                  {% for author, count in top_authors %}
                    <li>{{ author }} ‚Äî {{ count }} {{ count|ru_pluralize:"–∫–Ω–∏–≥–∞,–∫–Ω–∏–≥–∏,–∫–Ω–∏–≥" }}</li>
                  {% endfor %}
                </ul>
              {% else %}
                <p class="empty-note">–í —ç—Ç–æ–º –º–µ—Å—è—Ü–µ –∞–≤—Ç–æ—Ä—ã –ø–æ–∫–∞ –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–ª–∏—Å—å.</p>
              {% endif %}
            </div>
          </div>
          <div class="highlight-card">
            <div class="highlight-title">–î–∏–∞–ø–∞–∑–æ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è</div>
            <div class="highlight-body">
              {% if highlights.activity_start and highlights.activity_end %}
                –ß—Ç–µ–Ω–∏–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞–ª–æ {{ user.username }} —Å {{ highlights.activity_start|date:"d E" }} –ø–æ {{ highlights.activity_end|date:"d E" }}.
              {% else %}
                –ú–µ—Å—è—Ü —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è ‚Äî –≤–ø–µ—Ä–µ–¥–∏ –Ω–æ–≤—ã–µ –¥–∞—Ç—ã –∏ —Ç—ë–ø–ª—ã–µ –≤–µ—á–µ—Ä–∞ —Å –∫–Ω–∏–≥–æ–π.
              {% endif %}
              {% if highlights.top_day and highlights.top_day.pages %}
                <br>–°–∞–º—ã–π –Ω–∞—Å—ã—â–µ–Ω–Ω—ã–π –¥–µ–Ω—å ‚Äî {{ highlights.top_day.date|date:"d E" }}: {{ highlights.top_day.pages }} —Å—Ç—Ä.
              {% endif %}
            </div>
          </div>
        </div>
      </section>
    </div>
  </div>
</body>
</html>