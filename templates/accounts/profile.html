{% extends "base.html" %}
{% load role_filters shelf_extras %}

{% block title %}–ü—Ä–æ—Ñ–∏–ª—å {{ u.username }}{% endblock %}

{% block extra_css %}
  {{ block.super }}
  <style>
    /* –ë–∞–∑–æ–≤–∞—è —Å—Ç–∏–ª–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è */
    :root {
      --profile-accent-color: #9e8185;
      --profile-accent-color-dark: #b07c63;
      --profile-accent-color-text: #011627;
      --profile-glow: rgba(194, 150, 129, 0.3);
    }

    /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    @keyframes glow {
      0%, 100% { box-shadow: 0 0 20px var(--profile-glow); }
      50% { box-shadow: 0 0 30px var(--profile-glow); }
    }

    @keyframes slideIn {
      from { transform: translateX(-100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .animate-fade-in { animation: fadeInUp 0.8s ease-out forwards; }
    .animate-pulse { animation: pulse 2s ease-in-out infinite; }
    .animate-float { animation: float 3s ease-in-out infinite; }
    .animate-glow { animation: glow 2s ease-in-out infinite; }
    .animate-slide-in { animation: slideIn 0.6s ease-out forwards; }

    .profile-header {
      background: linear-gradient(135deg, rgba(194, 150, 129, 0.18), rgba(194, 150, 129, 0.05));
      border: 1px solid rgba(194, 150, 129, 0.3);
      border-radius: 1.25rem;
      padding: 1.75rem;
      opacity: 0;
      animation: fadeInUp 0.8s ease-out 0.2s forwards;
      position: relative;
      overflow: hidden;
    }

    .profile-header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(194, 150, 129, 0.1) 0%, transparent 70%);
      opacity: 0;
      transition: opacity 0.6s ease;
    }

    .profile-header:hover::before {
      opacity: 1;
    }

    .profile-username {
      color: var(--profile-accent-color-text);
      font-weight: 700;
      position: relative;
      display: inline-block;
    }

    .profile-username::after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 0;
      height: 2px;
      background: var(--profile-accent-color);
      transition: width 0.3s ease;
    }

    .profile-username:hover::after {
      width: 100%;
    }

    .profile-avatar {
      border: 4px solid rgba(194, 150, 129, 0.35);
      padding: 0.25rem;
      background: #fff;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .profile-avatar:hover {
      transform: scale(1.05);
      border-color: var(--profile-accent-color);
      box-shadow: 0 8px 25px rgba(194, 150, 129, 0.3);
    }

    .profile-avatar-placeholder {
      border: 4px solid rgba(194, 150, 129, 0.15);
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .profile-avatar-placeholder:hover {
      border-color: var(--profile-accent-color);
      background: rgba(194, 150, 129, 0.1);
    }

    .profile-actions { display: flex; flex-wrap: wrap; gap: 0.5rem; }

    .profile-action-button {
      border-color: rgba(194, 150, 129, 0.6);
      color: var(--profile-accent-color-text);
      font-weight: 600;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .profile-action-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(194, 150, 129, 0.2), transparent);
      transition: left 0.5s;
    }

    .profile-action-button:hover::before {
      left: 100%;
    }

    .profile-action-button:hover,
    .profile-action-button:focus {
      background-color: rgba(194, 150, 129, 0.12);
      border-color: var(--profile-accent-color);
      color: var(--profile-accent-color-text);
      transform: translateY(-2px);
    }

    .profile-rating-link { display:flex; flex-direction:column; align-items:flex-start; gap:.5rem; margin-top:1.5rem; }
    @media (min-width:576px){ .profile-rating-link{ flex-direction:row; align-items:center; } }

    .profile-rating-pill{
      display:inline-flex; align-items:center; gap:.4rem; padding:.35rem .85rem; border-radius:999px;
      background:rgba(194,150,129,.15); color:var(--profile-accent-color-text); font-size:.875rem; font-weight:600;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    .profile-rating-pill:hover {
      transform: translateY(-2px) scale(1.05);
      background: rgba(194,150,129,.25);
    }
    .profile-rating-pill i{ color:var(--profile-accent-color); }

    .profile-rating-button{
      background-color:var(--profile-accent-color); border-color:var(--profile-accent-color); color:#fff; font-weight:600; padding-inline:1.25rem;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    .profile-rating-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s;
    }
    .profile-rating-button:hover::before {
      left: 100%;
    }
    .profile-rating-button:hover,.profile-rating-button:focus{
      background-color:var(--profile-accent-color-dark); border-color:var(--profile-accent-color-dark); color:#fff;
      transform: translateY(-2px);
    }

    /* –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å —á—Ç–µ–Ω–∏—è */
    .reading-calendar-wrapper { 
      border-radius: var(--bs-border-radius-lg); 
      border:1px solid var(--bs-border-color); 
      overflow:hidden;
      opacity: 0;
      animation: fadeInUp 0.8s ease-out 0.6s forwards;
    }
    
    .reading-calendar { width:100%; border-collapse:collapse; table-layout:fixed; }
    .reading-calendar thead th,
    .reading-calendar tbody td {
      border:1px solid var(--bs-border-color);
      background-color:var(--bs-body-bg);
      padding:.75rem;
      vertical-align:top;
      width:14.2857142857%;
      transition: all 0.3s ease;
    }

    .reading-calendar tbody td {
      cursor: pointer;
    }

    .reading-calendar thead th { 
      text-align:center; 
      font-weight:600; 
      font-size:.75rem; 
      letter-spacing:.04em;
      cursor: pointer;
    }

    .reading-calendar thead th:hover {
      background: rgba(194, 150, 129, 0.1);
    }

    .reading-calendar__cell{ 
      display:flex; 
      flex-direction:column; 
      gap:.5rem; 
      min-height:140px;
      transition: all 0.3s ease;
    }

    .reading-calendar__cell:hover {
      transform: scale(1.02);
    }

    .reading-calendar__header{ 
      display:flex; 
      align-items:flex-start; 
      justify-content:space-between; 
      font-size:.875rem; 
      font-weight:600; 
    }
    .reading-calendar__header .text-muted{ color:var(--bs-secondary-color)!important; }
    .reading-calendar__books{ display:flex; flex-wrap:wrap; gap:.35rem; }
    .reading-calendar__book-cover,.reading-calendar__book-placeholder{ 
      width:40px; 
      height:60px; 
      border-radius:var(--bs-border-radius-sm); 
      box-shadow:0 .125rem .25rem rgba(15,23,42,.12); 
      flex:0 0 auto;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    .reading-calendar__book-cover:hover,
    .reading-calendar__book-placeholder:hover {
      transform: scale(1.1) rotate(2deg);
      box-shadow: 0 4px 12px rgba(15,23,42,.2);
    }
    .reading-calendar__book-cover{ object-fit:cover; }
    .reading-calendar__book-placeholder{
      background:var(--bs-tertiary-bg);
      border:1px dashed var(--bs-border-color);
      color:var(--bs-secondary-color);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:.75rem;
    }

    /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–µ—Ä–∏–æ–¥–∞ */
    .period-selector {
      background: linear-gradient(135deg, rgba(194, 150, 129, 0.1), rgba(194, 150, 129, 0.05));
      border-radius: 1.5rem;
      padding: 1.5rem;
    }

    .period-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
    }

    .period-tab {
      border: 1px solid transparent;
      border-radius: 999px;
      padding: 0.55rem 1.5rem;
      background: rgba(194, 150, 129, 0.12);
      color: var(--profile-accent-color-text);
      font-weight: 600;
      transition: all 0.3s ease;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
    }

    .period-tab:hover,
    .period-tab:focus {
      background: rgba(194, 150, 129, 0.24);
      transform: translateY(-1px);
      outline: none;
    }

    .period-tab.active {
      background: var(--profile-accent-color);
      color: #fff;
      box-shadow: 0 10px 30px rgba(194, 150, 129, 0.25);
    }

    .calendar-day__stats {
      margin-top: auto;
      padding-top: 0.25rem;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      font-size: 0.75rem;
      color: var(--profile-accent-color-text);
    }

    .calendar-day__meta-item {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      padding: 0.15rem 0.4rem;
      border-radius: 999px;
      background: rgba(194, 150, 129, 0.12);
      width: fit-content;
      margin-inline: auto;
    }

    .calendar-day__meta-value {
      font-weight: 700;
      line-height: 1;
    }

    .calendar-day__meta-label {
      color: var(--bs-secondary-color);
    }

    .calendar-day__meta-audio {
      color: #6c757d;
    }

    .calendar-day__meta-empty {
      opacity: 0.7;
      color: var(--bs-secondary-color);
      font-size: 0.7rem;
    }

    .profile-day-modal .modal-content {
      border-radius: 1.5rem;
      border: none;
      box-shadow: 0 20px 60px rgba(0,0,0,0.2);
    }

    .profile-day-modal .modal-header {
      border-bottom: 1px solid rgba(194, 150, 129, 0.2);
      background: linear-gradient(135deg, var(--profile-accent-color), var(--profile-accent-color-dark));
      color: #fff;
      border-radius: 1.5rem 1.5rem 0 0;
    }

    .profile-day-modal .modal-body {
      padding: 2rem;
    }

    .profile-day-modal .day-book {
      text-align: left;
      padding: 1rem;
      background: rgba(194, 150, 129, 0.08);
      border-radius: 1rem;
      transition: all 0.3s ease;
      height: 100%;
    }

    .profile-day-modal .day-book:hover {
      transform: translateY(-4px);
      background: rgba(194, 150, 129, 0.16);
    }

    .profile-day-modal .day-book-cover {
      width: 60px;
      height: 90px;
      object-fit: cover;
      border-radius: 0.5rem;
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }

    .profile-day-modal .day-books-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 1rem;
    }

    /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —è—á–µ–π–∫–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è */
    .calendar-day-active {
      background: linear-gradient(135deg, rgba(194, 150, 129, 0.2), rgba(194, 150, 129, 0.1));
      border: 1px solid rgba(194, 150, 129, 0.3) !important;
    }

    .calendar-day-active:hover {
      background: linear-gradient(135deg, rgba(194, 150, 129, 0.3), rgba(194, 150, 129, 0.2));
    }

    @media (max-width:991.98px){ .reading-calendar__cell{ min-height:120px; } }
    @media (max-width:575.98px){
      .reading-calendar thead th{ font-size:.65rem; }
      .reading-calendar__cell{ min-height:110px; gap:.35rem; }
      .reading-calendar__header{ font-size:.75rem; }
      .reading-calendar__books{ gap:.25rem; }
      .reading-calendar__book-cover,.reading-calendar__book-placeholder{ width:32px; height:48px; }
      .calendar-day__stats{ font-size:.6rem; gap:.1rem; }
      .calendar-day__meta-item{ gap:.2rem; padding:.1rem .35rem; }
      .calendar-day__meta-item i{ font-size:.65rem; }
      .calendar-day__meta-value{ font-size:.65rem; }
      .calendar-day__meta-label{ display:none; }
    }

    /* === –ñ–Å–°–¢–ö–û–ï –ü–ï–†–ï–û–ü–†–ï–î–ï–õ–ï–ù–ò–ï Bootstrap ‚Äî —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ .profile-theme === */
    .profile-theme{ --profile-accent-color:#c29681; --profile-accent-color-dark:#b07c63; }

    /* —Å—Å—ã–ª–∫–∏ */
    .profile-theme a{ color:var(--profile-accent-color) !important; transition: color 0.3s ease; }
    .profile-theme a:hover, .profile-theme a:focus{ color:var(--profile-accent-color-dark) !important; }

    /* –∫–Ω–æ–ø–∫–∏ */
    .profile-theme .btn-primary{
      background-color:var(--profile-accent-color) !important;
      border-color:var(--profile-accent-color) !important;
      color: #011627 !important;
      transition: all 0.3s ease;
    }
    .profile-theme .btn-primary:hover,
    .profile-theme .btn-primary:focus{
      background-color:var(--profile-accent-color-dark) !important;
      border-color:var(--profile-accent-color-dark) !important;
      transform: translateY(-2px);
    }
    .profile-theme .btn-outline-primary{
      color: #011627 !important;
      border-color:var(--profile-accent-color) !important;
      transition: all 0.3s ease;
    }
    .profile-theme .btn-outline-primary:hover,
    .profile-theme .btn-outline-primary:focus{
      background-color:var(--profile-accent-color) !important;
      border-color:var(--profile-accent-color) !important;
      color:#011627 !important;
      transform: translateY(-2px);
    }

    /* –≤–∫–ª–∞–¥–∫–∏ */
    .profile-theme #profileTabs .nav-link{ 
      color: #011627 !important; 
      transition: all 0.3s ease;
      position: relative;
    }
    .profile-theme #profileTabs .nav-link::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 50%;
      width: 0;
      height: 2px;
      background: var(--profile-accent-color);
      transition: all 0.3s ease;
      transform: translateX(-50%);
    }
    .profile-theme #profileTabs .nav-link:hover::after {
      width: 80%;
    }
    .profile-theme #profileTabs .nav-link:hover{ color:var(--profile-accent-color-dark) !important; }
    .profile-theme #profileTabs .nav-link.active{
      color:#011627 !important;
      border-color:var(--profile-accent-color) var(--profile-accent-color) #011627 !important;
    }
    .profile-theme #profileTabs .nav-link.active::after {
      width: 100%;
    }

    /* —á–µ–∫–±–æ–∫—Å—ã/—Ä–∞–¥–∏–æ –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏—è, –µ—Å–ª–∏ –ø–æ—è–≤—è—Ç—Å—è */
    .profile-theme .form-check-input:checked{
      background-color:var(--profile-accent-color) !important;
      border-color:var(--profile-accent-color) !important;
    }
    .profile-theme .page-item.active .page-link{
      background-color:var(--profile-accent-color) !important;
      border-color:var(--profile-accent-color) !important;
      color: #011627 !important;
    }

    /* –ë–µ–ª—ã–π —Ç–µ–∫—Å—Ç –≤ –ø–ª–∞—à–∫–µ –±–∞–ª–ª–æ–≤ –∏ –Ω–∞ –∫–Ω–æ–ø–∫–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ */
    .profile-theme .profile-rating-pill{
      background-color: var(--profile-accent-color);
      color: #011627 !important;
    }
    .profile-theme .profile-rating-pill i{
      color: #011627 !important;
    }

    .profile-theme .profile-rating-button{
      color: #011627 !important;
    }
    .profile-theme .profile-rating-button:hover,
    .profile-theme .profile-rating-button:focus{
      color: #011627 !important;
    }

    /* —Ç—ë–º–Ω–∞—è —Ç–µ–º–∞ */
    [data-bs-theme="dark"] .profile-theme #profileTabs .nav-link,
    [data-bs-theme="dark"] .profile-theme a{ color:var(--profile-accent-color) !important; }
    [data-bs-theme="dark"] .profile-theme .btn-outline-primary:hover{ color:#fff !important; }
    .profile-theme a.btn.profile-action-button { color:#011627 !important; }

    /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ */
    .stat-card {
      opacity: 0;
      transform: translateY(30px);
      transition: all 0.6s ease;
      border: none !important;
      background: linear-gradient(135deg, #fff, #f8f9fa) !important;
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(194, 150, 129, 0.1), transparent);
      transition: left 0.6s ease;
    }

    .stat-card:hover::before {
      left: 100%;
    }

    .stat-card.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.1) !important;
    }

    /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —á–∏—Å–ª–∞ */
    .animated-number {
      font-variant-numeric: tabular-nums;
    }

    /* –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã */
    .reading-progress {
      height: 8px;
      border-radius: 10px;
      overflow: hidden;
      background: rgba(0,0,0,0.1);
      margin: 10px 0;
    }

    .progress-bar-animated {
      background: linear-gradient(90deg, var(--profile-accent-color), var(--profile-accent-color-dark));
      transition: width 1s ease-in-out;
    }

    /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–Ω–∏–≥–∏ */
    .book-card {
      transition: all 0.4s ease;
      border: none !important;
      overflow: hidden;
    }

    .book-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      transition: left 0.6s ease;
    }

    .book-card:hover::before {
      left: 100%;
    }

    .book-card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 15px 40px rgba(0,0,0,0.15) !important;
    }

    .book-cover {
      transition: all 0.4s ease;
    }

    .book-card:hover .book-cover {
      transform: scale(1.05);
    }

    /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–∑—ã–≤—ã */
    .review-card {
      opacity: 0;
      transform: translateX(-50px);
      transition: all 0.6s ease;
      border: none !important;
    }

    .review-card.visible {
      opacity: 1;
      transform: translateX(0);
    }

    .review-card:hover {
      transform: translateX(10px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.1) !important;
    }

    /* –ü—É–ª—å—Å–∏—Ä—É—é—â–∏–µ –±–µ–π–¥–∂–∏ */
    .badge-pulse {
      animation: pulse 2s infinite;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤–∫–ª–∞–¥–æ–∫ */
    .tab-pane {
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.5s ease;
    }

    .tab-pane.show.active {
      opacity: 1;
      transform: translateY(0);
    }

    /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
    .profile-notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--profile-accent-color);
      color: #011627;
      padding: 1rem 1.5rem;
      border-radius: 10px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
      z-index: 1060;
      transform: translateX(400px);
      opacity: 0;
      transition: all 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    .profile-notification.show {
      transform: translateX(0);
      opacity: 1;
    }

    :root { --book-info-min-h: 120px; }
    @media (max-width: 575.98px){ :root { --book-info-min-h: 110px; } }

    /* –∫–∞–∂–¥–∞—è –∫–Ω–∏–∂–∫–∞ ‚Äî –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ */
    .book-item{
      display:flex;
      flex-direction:column;
      align-items:center;            /* –æ–±–ª–æ–∂–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –ø–æ —Ü–µ–Ω—Ç—Ä—É */
      transition: all 0.3s ease;
    }

    .book-item:hover {
      transform: translateY(-5px);
    }

    /* –∏–Ω—Ñ–æ–±–ª–æ–∫ —Å –ø–æ–¥–ª–æ–∂–∫–æ–π */
    .book-info{
      width:100%;
      margin-top:.6rem;
      padding:.6rem .6rem .65rem;
      background: rgba(255,255,255,.88);            /* —Å–≤–µ—Ç–ª–∞—è –ø–æ–¥–ª–æ–∂–∫–∞ */
      border: 1px solid rgba(0,0,0,.06);
      border-radius: .75rem;
      box-shadow: 0 .35rem .85rem rgba(0,0,0,.06);
      display:flex;
      flex-direction:column;
      min-height: var(--book-info-min-h);           /* –í–ê–ñ–ù–û: –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è –≤—ã—Å–æ—Ç–∞ */
      transition: all 0.3s ease;
    }

    .book-item:hover .book-info {
      box-shadow: 0 .5rem 1.5rem rgba(0,0,0,.1);
      border-color: rgba(194, 150, 129, 0.3);
    }

    /* –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –∞–≤—Ç–æ—Ä ‚Äî –æ–≥—Ä–∞–Ω–∏—á–∏–º –∫–æ–ª-–≤–æ —Å—Ç—Ä–æ–∫, —á—Ç–æ–±—ã –Ω–µ ¬´–≥—É–ª—è–ª–æ¬ª */
    .book-title{
      margin:0;
      font-size:.9rem;
      font-weight:600;
      line-height:1.3;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
      transition: color 0.3s ease;
    }

    .book-item:hover .book-title {
      color: var(--profile-accent-color);
    }

    .book-author{
      margin-top:.15rem;
      font-size:.75rem;
      color:rgba(33,37,41,.65);
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
    }

    /* –Ω–∏–∂–Ω—è—è –∑–æ–Ω–∞ (–∫–Ω–æ–ø–∫–∞/–ø–æ–¥–ø–∏—Å—å) –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–∂–∞—Ç–∞ –≤–Ω–∏–∑ */
    .book-actions{
      margin-top:auto;               /* –º–∞–≥–∏—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è –ø–æ –æ–¥–Ω–æ–π –ª–∏–Ω–∏–∏ */
      width:100%;
    }

    /* –º–µ–ª–∫–∞—è –∫–æ—Å–º–µ—Ç–∏–∫–∞ –ø–æ–¥ —Ç–≤–æ—é –≥–∞–º–º—É */
    .book-actions__button{
      border-color: #9d6f51;
      color:#9d6f51;
      transition: all 0.3s ease;
    }
    .book-actions__button:hover,
    .book-actions__button:focus{
      background:#9d6f51;
      border-color:#9d6f51;
      color:#fff;
      transform: translateY(-2px);
    }

    /* —á—É—Ç—å –º—è–≥—á–µ —Ñ–æ–Ω ¬´–ø–æ–ª–∫–∏¬ª –¥–ª—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –ø–æ–≤–µ—Ä—Ö –∫–∞—Ä—Ç–∏–Ω–∫–∏ */
    .shelf-card__body::before{
      background:
        linear-gradient(180deg, rgba(255,255,255,.55), rgba(255,255,255,.35)) !important;
    }
    .shelf-card .book-info{
      position: relative;
      z-index: 2;                                /* –≤—ã—à–µ –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö —Å–ª–æ—ë–≤ –ø–æ–ª–∫–∏ */
      width: 100%;
      margin-top: .6rem;
      padding: .6rem .6rem .65rem;
      background: rgba(255,255,255,.96) !important; /* –±—ã–ª–∞ —Å–ª–∏—à–∫–æ–º –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–π */
      border: 1px solid rgba(157,111,81,.25);
      border-radius: .75rem;
      box-shadow: 0 .35rem .85rem rgba(0,0,0,.06);
      display: flex;
      flex-direction: column;
      min-height: var(--book-info-min-h, 120px);
      text-align: left;                           /* —á–∏—Ç–∞–µ–º–µ–µ –Ω–∞ —É–∑–∫–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ */
      backdrop-filter: saturate(120%) blur(1.5px);
      -webkit-backdrop-filter: blur(1.5px);
      transition: all 0.3s ease;
    }

    .shelf-card:hover .book-info {
      border-color: rgba(157,111,81,.5);
      box-shadow: 0 .5rem 1.5rem rgba(0,0,0,.1);
    }

    /* –∑–∞–≥–æ–ª–æ–≤–æ–∫/–∞–≤—Ç–æ—Ä –ø–æ –ø–ª–∞—à–∫–µ, —Å –æ–±—Ä–µ–∑–∫–æ–π —Å—Ç—Ä–æ–∫ */
    .shelf-card .book-info .book-title{
      margin: 0;
      font-size: .9rem;
      font-weight: 600;
      line-height: 1.3;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .shelf-card .book-info .book-author{
      margin-top: .15rem;
      font-size: .75rem;
      color: rgba(33,37,41,.65);
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    /* –∫–Ω–æ–ø–∫–∞/–ø–æ–¥–ø–∏—Å—å –≤—Å–µ–≥–¥–∞ –Ω–∞ –æ–¥–Ω–æ–π –ª–∏–Ω–∏–∏ –≤–Ω–∏–∑—É */
    .shelf-card .book-info .book-actions{
      margin-top: auto;
      width: 100%;
    }

    /* –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π –ø–æ–¥–Ω–∏–º–µ–º z-index —É —Ç–µ–∫—Å—Ç–∞ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–ª–∞ –ø–æ–ª–∫–∏ */
    .shelf-card__body > *{ position: relative; z-index: 1; }

    /* –µ—Å–ª–∏ ¬´–±—Ä—É—Å–æ–∫¬ª –ø–æ–ª–∫–∏ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç, –æ–ø—É—Å—Ç–∏–º –µ–≥–æ —Å–ª–æ–π */
    .shelf-card__body::after{ z-index: 0 !important; }

    @media (max-width:575.98px){
      :root{ --book-info-min-h: 110px; }
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ */
    .loading-skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
    }

    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* –≠—Ñ—Ñ–µ–∫—Ç –ø–∞—Ä–∞–ª–ª–∞–∫—Å–∞ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ */
    .parallax-header {
      transform: translateY(0);
      transition: transform 0.3s ease-out;
    }

    /* –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏ */
    .chart-container {
      position: relative;
      opacity: 0;
      transform: scale(0.8);
      transition: all 0.6s ease;
    }

    .chart-container.visible {
      opacity: 1;
      transform: scale(1);
    }

    /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω */
    .animated-bg {
      position: relative;
      overflow: hidden;
    }

    .animated-bg::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: conic-gradient(from 0deg, transparent, rgba(194, 150, 129, 0.1), transparent);
      animation: rotate 10s linear infinite;
      z-index: 0;
    }

    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .animated-bg > * {
      position: relative;
      z-index: 1;
    }
  </style>
{% endblock %}

{% block content %}
<div class="profile-theme"><!-- –í–ê–ñ–ù–û: –≤—Å—ë —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–π –æ–±—ë—Ä—Ç–∫–∏ -->

  <div class="profile-header d-flex flex-column flex-md-row gap-4 align-items-start animated-bg">
    <!-- –ê–≤–∞—Ç–∞—Ä -->
    <div>
      {% if u.profile.avatar %}
        <img src="{{ u.profile.avatar.url }}"
             class="rounded-circle shadow-sm profile-avatar animate-float"
             style="width:140px;height:140px;object-fit:cover"
             alt="–ê–≤–∞—Ç–∞—Ä {{ u.username }}"
             onclick="showProfileNotification('–≠—Ç–æ –≤–∞—à –∞–≤–∞—Ç–∞—Ä! üé®')">
      {% else %}
        <div class="rounded-circle bg-secondary-subtle d-flex align-items-center justify-content-center shadow-sm profile-avatar-placeholder animate-pulse"
             style="width:140px;height:140px"
             onclick="showProfileNotification('–î–æ–±–∞–≤—å—Ç–µ –∞–≤–∞—Ç–∞—Ä –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è! üì∏')">
          <span class="text-muted small">–ù–µ—Ç –∞–≤–∞—Ç–∞—Ä–∞</span>
        </div>
      {% endif %}
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class="flex-grow-1">
      <h1 class="h4 mb-1 profile-username animate-glow">@{{ u.username }}</h1>
      {% if u.get_full_name %}
        <div class="text-muted mb-2">{{ u.get_full_name }}</div>
      {% endif %}

      <!-- –†–æ–ª–∏ -->
      <div class="mt-2 mb-3">
        {% for g in u.groups.all %}
          <span class="badge text-bg-light me-1 badge-pulse">{{ g.name|role_display }}</span>
        {% empty %}
          <span class="badge text-bg-light">–ë–µ–∑ —Ä–æ–ª–∏</span>
        {% endfor %}
      </div>

      {% if active_premium %}
      <div class="mb-3">
        <span class="badge text-bg-warning text-dark animate-pulse">
          <i class="bi bi-gem-fill me-1"></i>–ü—Ä–µ–º–∏—É–º –¥–æ {{ active_premium.end_at|date:"d.m.Y" }}
        </span>
        {% if premium_is_self %}
          <a class="ms-2 small" href="{% url 'premium_overview' %}">–£–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ–¥–ø–∏—Å–∫–æ–π</a>
        {% endif %}
      </div>
      {% elif premium_is_self %}
      <div class="mb-3">
        <a class="btn btn-sm btn-primary animate-glow" href="{% url 'premium_overview' %}">
          <i class="bi bi-gem me-1"></i>–û—Ñ–æ—Ä–º–∏—Ç—å –ø—Ä–µ–º–∏—É–º
        </a>
      </div>
      {% endif %}

      {% if show_coin_balance %}
      <div class="mb-3">
        <span class="badge text-bg-light text-dark">
          <i class="bi bi-coin me-1"></i>
          {% if has_unlimited_coins %}
            –ë–µ–∑–ª–∏–º–∏—Ç–Ω—ã–µ –º–æ–Ω–µ—Ç—ã
          {% else %}
            –ë–∞–ª–∞–Ω—Å: <span class="animated-number" data-target="{{ coin_balance|default_if_none:0 }}">0</span>
          {% endif %}
        </span>
      </div>
      {% endif %}

      <!-- –ë–∏–æ –∏ —Å–∞–π—Ç -->
      <div class="mb-3">
        <p class="mb-1">{{ u.profile.bio|default:"–ü–æ–∫–∞ –±–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è." }}</p>
        {% if u.profile.website %}
          <p class="mb-0">
            <i class="bi bi-link-45deg"></i>
            <a href="{{ u.profile.website }}" target="_blank" rel="noopener">{{ u.profile.website }}</a>
          </p>
        {% endif %}
      </div>

      <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
      <div class="profile-actions">
        {% if request.user == u %}
          <a class="btn btn-sm profile-action-button" href="{% url 'profile_edit' %}">
            <i class="bi bi-pencil me-1"></i>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
          </a>
        {% endif %}
        <a class="btn btn-sm profile-action-button" href="{% url 'book_list' %}">
          –ö –∫–Ω–∏–≥–∞–º
        </a>
      </div>

      <div class="profile-rating-link">
        <span class="profile-rating-pill" onclick="showProfileNotification('–í–∞—à–∏ —á–∏—Ç–∞—Ç–µ–ª—å—Å–∫–∏–µ –±–∞–ª–ª—ã! üìö')">
          <i class="bi bi-stars"></i>
          <span class="animated-number" data-target="{{ rating_points_total|default_if_none:0 }}">0</span> {{ rating_points_total|ru_pluralize:"–±–∞–ª–ª,–±–∞–ª–ª–∞,–±–∞–ª–ª–æ–≤" }}
        </span>
        <span class="profile-rating-pill" onclick="showProfileNotification('–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü! üìñ')">
          <i class="bi bi-book"></i>
          <span class="animated-number" data-target="{{ reading_pages_total|default_if_none:0 }}">0</span> {{ reading_pages_total|ru_pluralize:"—Å—Ç—Ä–∞–Ω–∏—Ü–∞,—Å—Ç—Ä–∞–Ω–∏—Ü—ã,—Å—Ç—Ä–∞–Ω–∏—Ü" }}
        </span>
        <a class="btn btn-sm profile-rating-button" href="{% url 'shelves:reading_leaderboard' %}">
          –†–µ–π—Ç–∏–Ω–≥ —á–∏—Ç–∞—Ç–µ–ª–µ–π
        </a>
      </div>
    </div>
  </div>

  <!-- –í–∫–ª–∞–¥–∫–∏ -->
  {% with current_tab=active_tab|default:"overview" %}
  <ul class="nav nav-tabs mt-4" id="profileTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link{% if current_tab == 'overview' %} active{% endif %}" id="overview-tab" data-bs-toggle="tab"
              data-bs-target="#overview" type="button" role="tab" aria-selected="{% if current_tab == 'overview' %}true{% else %}false{% endif %}">
        <i class="bi bi-house me-1"></i>–û–±–∑–æ—Ä
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link{% if current_tab == 'stats' %} active{% endif %}" id="stats-tab" data-bs-toggle="tab"
              data-bs-target="#stats" type="button" role="tab" aria-selected="{% if current_tab == 'stats' %}true{% else %}false{% endif %}">
        <i class="bi bi-bar-chart me-1"></i>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link{% if current_tab == 'books' %} active{% endif %}" id="books-tab" data-bs-toggle="tab"
              data-bs-target="#books" type="button" role="tab" aria-selected="{% if current_tab == 'books' %}true{% else %}false{% endif %}">
        <i class="bi bi-book me-1"></i>–ú–æ–∏ –∫–Ω–∏–≥–∏
      </button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link{% if current_tab == 'reviews' %} active{% endif %}" id="reviews-tab" data-bs-toggle="tab"
              data-bs-target="#reviews" type="button" role="tab" aria-selected="{% if current_tab == 'reviews' %}true{% else %}false{% endif %}">
        <i class="bi bi-chat-quote me-1"></i>–û–±–∑–æ—Ä—ã
      </button>
    </li>
  </ul>

  <div class="tab-content mt-3" id="profileTabsContent">
    <!-- –û–±–∑–æ—Ä -->
    <div class="tab-pane fade{% if current_tab == 'overview' %} show active{% endif %}" id="overview" role="tabpanel">
      <p class="text-muted">–ó–¥–µ—Å—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.</p>

      <!-- –°–æ—Ü—Å–µ—Ç–∏ –±–ª–æ–≥–µ—Ä–∞ -->
      {% if is_blogger %}
        <hr>
        <h5>–ú–æ–∏ —Å–æ—Ü—Å–µ—Ç–∏</h5>
        <ul class="list-unstyled">
          {% if u.profile.link1 %}<li><a href="{{ u.profile.link1 }}" target="_blank" rel="noopener">{{ u.profile.link1 }}</a></li>{% endif %}
          {% if u.profile.link2 %}<li><a href="{{ u.profile.link2 }}" target="_blank" rel="noopener">{{ u.profile.link2 }}</a></li>{% endif %}
          {% if u.profile.link3 %}<li><a href="{{ u.profile.link3 }}" target="_blank" rel="noopener">{{ u.profile.link3 }}</a></li>{% endif %}
          {% if u.profile.link4 %}<li><a href="{{ u.profile.link4 }}" target="_blank" rel="noopener">{{ u.profile.link4 }}</a></li>{% endif %}
        </ul>
      {% endif %}

      <div class="shelf-page__header mt-4">
        <h2 class="h5 shelf-page__title mb-0">–ö–Ω–∏–∂–Ω—ã–µ –ø–æ–ª–∫–∏</h2>
        {% if request.user == u %}
          <a class="btn btn-outline-primary btn-sm" href="{% url 'shelves:shelf_create' %}">
            <i class="bi bi-plus-lg me-1"></i>–î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–∫—É
          </a>
        {% endif %}
      </div>
      {% include "shelves/_shelf_cards.html" with shelves=user_shelves allow_manage=allow_shelf_management empty_message=allow_shelf_management|yesno:"–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–ª–æ–∫.,–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ–ª–æ–∫.,–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ–ª–æ–∫." next_url=request.get_full_path default_reading_shelf_name=default_reading_shelf_name default_home_library_shelf_name=default_home_library_shelf_name default_read_shelf_name=default_read_shelf_name reading_progress_label=reading_progress_label status_user_override=u %}
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="tab-pane fade{% if current_tab == 'stats' %} show active{% endif %}" id="stats" role="tabpanel">
      <div class="card border-0 shadow-sm mb-4 stat-card" data-delay="0">
        <div class="card-body period-selector">
          <form method="get" class="period-form" id="statsFilterForm">
            <input type="hidden" name="tab" value="stats">

            <div class="period-tabs" role="tablist" aria-label="–í—ã–±–æ—Ä –ø–µ—Ä–∏–æ–¥–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏">
              <button type="button" class="period-tab{% if stats_period.period == 'day' %} active{% endif %}" data-period="day" aria-pressed="{% if stats_period.period == 'day' %}true{% else %}false{% endif %}">
                <i class="bi bi-sun"></i>
                –î–µ–Ω—å
              </button>
              <button type="button" class="period-tab{% if stats_period.period == 'week' %} active{% endif %}" data-period="week" aria-pressed="{% if stats_period.period == 'week' %}true{% else %}false{% endif %}">
                <i class="bi bi-calendar-week"></i>
                –ù–µ–¥–µ–ª—è
              </button>
              <button type="button" class="period-tab{% if stats_period.period == 'month' %} active{% endif %}" data-period="month" aria-pressed="{% if stats_period.period == 'month' %}true{% else %}false{% endif %}">
                <i class="bi bi-calendar2-month"></i>
                –ú–µ—Å—è—Ü
              </button>
              <button type="button" class="period-tab{% if stats_period.period == 'year' %} active{% endif %}" data-period="year" aria-pressed="{% if stats_period.period == 'year' %}true{% else %}false{% endif %}">
                <i class="bi bi-calendar4"></i>
                –ì–æ–¥
              </button>
            </div>

            <div class="row g-3 align-items-end">
              <div class="col-12 col-md-4 period-select-fallback">
                <label class="form-label" for="id_period">–ü–µ—Ä–∏–æ–¥</label>
                <select class="form-select" id="id_period" name="period">
                  <option value="day"{% if stats_period.period == 'day' %} selected{% endif %}>–î–µ–Ω—å</option>
                  <option value="week"{% if stats_period.period == 'week' %} selected{% endif %}>–ü–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π</option>
                  <option value="month"{% if stats_period.period == 'month' %} selected{% endif %}>–ú–µ—Å—è—Ü</option>
                  <option value="year"{% if stats_period.period == 'year' %} selected{% endif %}>–ì–æ–¥</option>
                </select>
              </div>
              {% if stats_period.available_years and stats_period.period != 'day' %}
                <div class="col-6 col-md-4">
                  <label class="form-label" for="id_year">–ì–æ–¥</label>
                  <select class="form-select" id="id_year" name="year">
                    {% for year in stats_period.available_years %}
                      <option value="{{ year }}"{% if year == stats_period.selected_year %} selected{% endif %}>{{ year }}</option>
                    {% endfor %}
                  </select>
                </div>
              {% endif %}
              {% if stats_period.period == 'day' %}
                <div class="col-12 col-md-4">
                  <label class="form-label" for="id_date">–î–∞—Ç–∞</label>
                  <input
                    type="date"
                    class="form-control"
                    id="id_date"
                    name="date"
                    value="{{ stats_period.selected_day|date:'Y-m-d' }}"
                    {% if stats_period.last_available_day and stats_period.first_available_day %}
                      min="{{ stats_period.last_available_day.iso }}"
                      max="{{ stats_period.first_available_day.iso }}"
                    {% endif %}
                  >
                  {% if stats_period.last_available_day and stats_period.first_available_day %}
                    <div class="form-text">–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞—Ç—ã —Å {{ stats_period.last_available_day.display }} –ø–æ {{ stats_period.first_available_day.display }}.</div>
                  {% endif %}
                </div>
              {% endif %}
              {% if stats_period.period == 'month' and stats_period.available_months %}
                <div class="col-6 col-md-4">
                  <label class="form-label" for="id_month">–ú–µ—Å—è—Ü</label>
                  <select class="form-select" id="id_month" name="month">
                    {% for month_value, month_name in stats_period.available_months %}
                      <option value="{{ month_value }}"{% if month_value == stats_period.selected_month %} selected{% endif %}>{{ month_name }}</option>
                    {% endfor %}
                  </select>
                </div>
              {% endif %}
              <div class="col-12 col-md-auto">
                <button type="submit" class="btn btn-primary">–û–±–Ω–æ–≤–∏—Ç—å</button>
              </div>
            </div>
          </form>
        </div>
      </div>

      <p class="text-muted">–ü–µ—Ä–∏–æ–¥: {{ stats_period.label }} ({{ stats_period.start|date:"d.m.Y" }} ‚Äî {{ stats_period.end|date:"d.m.Y" }})</p>

      {% with calendar=stats.reading_calendar %}
        {% if calendar %}
          <div class="card border-0 shadow-sm mb-4 stat-card" data-delay="100">
            <div class="card-body">
              <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-3 mb-3">
                <div>
                  <h3 class="h6 mb-1">–ö–∞–ª–µ–Ω–¥–∞—Ä—å —á—Ç–µ–Ω–∏—è</h3>
                  <p class="text-muted small mb-0">–°–∫–æ–ª—å–∫–æ –≤—ã –ø—Ä–æ—á–∏—Ç–∞–ª–∏ –≤ —ç—Ç–æ–º –º–µ—Å—è—Ü–µ?</p>
                </div>
                <div class="btn-group btn-group-sm" role="group" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º">
                  <a class="btn btn-outline-secondary" href="{{ calendar.prev_url }}" aria-label="–ü—Ä–µ–¥—ã–¥—É—â–∏–π –º–µ—Å—è—Ü">
                    <i class="bi bi-chevron-left"></i>
                  </a>
                  <span class="btn btn-light disabled text-nowrap">
                    {{ calendar.month_name }} {{ calendar.year }}
                  </span>
                  <a class="btn btn-outline-secondary" href="{{ calendar.next_url }}" aria-label="–°–ª–µ–¥—É—é—â–∏–π –º–µ—Å—è—Ü">
                    <i class="bi bi-chevron-right"></i>
                  </a>
                </div>
              </div>
              <div class="table-responsive reading-calendar-wrapper">
                <table class="reading-calendar align-middle mb-0">
                  <thead class="text-muted text-uppercase small">
                    <tr>
                      {% for weekday in calendar.weekday_labels %}
                        <th scope="col">{{ weekday }}</th>
                      {% endfor %}
                    </tr>
                  </thead>
                  <tbody>
                    {% for week in calendar.weeks %}
                      <tr>
                        {% for day in week %}
                          <td class="{% if not day.in_month %}opacity-75{% endif %} {% if day.books %}calendar-day-active{% endif %}"
                              {% if day.in_month %}data-date="{{ day.date|date:"Y-m-d" }}"{% endif %}
                              role="button"
                              tabindex="0"
                              aria-label="{{ day.date|date:'d E Y' }}{% if day.books_count %}, –∫–Ω–∏–≥: {{ day.books_count }}{% endif %}{% if day.pages_total %}, —Å—Ç—Ä–∞–Ω–∏—Ü: {{ day.pages_total }}{% endif %}"
                              onclick="showDayDetails('{{ day.date|date:"Y-m-d" }}')">
                            <div class="reading-calendar__cell">
                              <div class="reading-calendar__header">
                                <span class="{% if not day.in_month %}text-muted{% endif %}">{{ day.date.day }}</span>
                                {% if day.is_completion_day and day.in_month %}
                                  <i class="bi bi-star-fill text-warning" title="–ï—Å—Ç—å –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∫–Ω–∏–≥–∏"></i>
                                {% endif %}
                              </div>
                              {% if day.in_month and day.books %}
                                <div class="reading-calendar__books">
                                  {% for book in day.books %}
                                    {% if book.cover_url %}
                                      <img src="{{ book.cover_url }}" alt="–û–±–ª–æ–∂–∫–∞ {{ book.title }}" class="reading-calendar__book-cover">
                                    {% else %}
                                      <div class="reading-calendar__book-placeholder">
                                        <span class="visually-hidden">{{ book.title }}</span>
                                        –ù–µ—Ç
                                      </div>
                                    {% endif %}
                                  {% endfor %}
                                </div>
                              {% endif %}
                              <div class="calendar-day__stats">
                                {% if day.pages_total %}
                                  <div class="calendar-day__meta-item">
                                    <strong class="calendar-day__meta-value">{{ day.pages_total }}</strong>
                                    <span class="calendar-day__meta-label">{{ day.pages_total|ru_pluralize:"—Å—Ç—Ä–∞–Ω–∏—Ü–∞,—Å—Ç—Ä–∞–Ω–∏—Ü—ã,—Å—Ç—Ä–∞–Ω–∏—Ü" }}</span>
                                  </div>
                                {% endif %}
                                {% if day.books_count %}
                                  <div class="calendar-day__meta-item">
                                    <i class="bi bi-book"></i>
                                    <strong class="calendar-day__meta-value">{{ day.books_count }}</strong>
                                    <span class="calendar-day__meta-label">{{ day.books_count|ru_pluralize:"–∫–Ω–∏–≥–∞,–∫–Ω–∏–≥–∏,–∫–Ω–∏–≥" }}</span>
                                  </div>
                                {% endif %}
                                {% if day.audio_minutes %}
                                  <div class="calendar-day__meta-item calendar-day__meta-audio">
                                    <i class="bi bi-headphones"></i>
                                    <strong class="calendar-day__meta-value">{{ day.audio_minutes }}</strong>
                                    <span class="calendar-day__meta-label">{{ day.audio_minutes|ru_pluralize:"–º–∏–Ω—É—Ç–∞,–º–∏–Ω—É—Ç—ã,–º–∏–Ω—É—Ç" }}</span>
                                  </div>
                                {% endif %}
                                {% if not day.books_count and not day.pages_total and not day.audio_minutes and day.in_month %}
                                  <div class="calendar-day__meta-empty">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>
                                {% endif %}
                              </div>
                            </div>
                          </td>
                        {% endfor %}
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
              {% if not calendar.has_activity %}
                <p class="text-muted small mb-0 mt-3">–í —ç—Ç–æ–º –º–µ—Å—è—Ü–µ –ø–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π —á—Ç–µ–Ω–∏—è.</p>
              {% endif %}
            </div>
          </div>
          {% if calendar.month_totals %}
            <div class="period-stats mt-4">
              <h4 class="mb-3">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ {{ calendar.month_name }} {{ calendar.year }}</h4>
              <div class="stats-grid">
                <div class="stat-item">
                  <div class="stat-value animated-number" data-target="{{ calendar.month_totals.pages_total|default_if_none:0 }}">0</div>
                  <div class="stat-label">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å—Ç—Ä–∞–Ω–∏—Ü</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value animated-number" data-target="{{ calendar.month_totals.books_count|default_if_none:0 }}">0</div>
                  <div class="stat-label">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ –∫–Ω–∏–≥</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value animated-number" data-target="{{ calendar.month_totals.reading_days|default_if_none:0 }}">0</div>
                  <div class="stat-label">–î–Ω–µ–π —Å —á—Ç–µ–Ω–∏–µ–º</div>
                </div>
                <div class="stat-item">
                  <div class="stat-value animated-number" data-target="{{ calendar.month_totals.avg_pages|default_if_none:0 }}" data-decimals="1">0</div>
                  <div class="stat-label">–°—Ä–µ–¥–Ω–µ–µ —Å—Ç—Ä–∞–Ω–∏—Ü –≤ –¥–µ–Ω—å</div>
                </div>
              </div>
            </div>
          {% endif %}
          {% if calendar.day_payloads %}
            {{ calendar.day_payloads|json_script:"profile-calendar-day-data" }}
          {% endif %}
        {% endif %}
      {% endwith %}

      <div class="row g-3 mb-4">
        <div class="col-12 col-lg-6 col-xl-3">
          <div class="card border-0 shadow-sm h-100 stat-card" data-delay="200">
            <div class="card-body">
              <h3 class="h6 mb-2">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å—Ç—Ä–∞–Ω–∏—Ü</h3>
              <p class="display-6 mb-0 animated-number" data-target="{{ stats.pages_total|default_if_none:0 }}">0</p>
              {% if stats.pages_average %}
                <p class="text-muted mb-0">–í —Å—Ä–µ–¥–Ω–µ–º <span class="animated-number" data-target="{{ stats.pages_average|default_if_none:0 }}" data-decimals="2">0</span> —Å—Ç—Ä./–¥–µ–Ω—å</p>
              {% else %}
                <p class="text-muted mb-0">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥.</p>
              {% endif %}
              <div class="reading-progress mt-2">
                <div class="progress-bar-animated" style="width: {% widthratio stats.pages_total stats.pages_total|add:1000 100 %}%"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-12 col-lg-6 col-xl-3">
          <div class="card border-0 shadow-sm h-100 stat-card" data-delay="300">
            <div class="card-body">
              <h3 class="h6 mb-2">–ê—É–¥–∏–æ–∫–Ω–∏–≥–∏</h3>
              {% if stats.audio_tracked_display %}
                <p class="mb-1">–£—á—Ç–µ–Ω–æ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è: <strong>{{ stats.audio_tracked_display }}</strong></p>
              {% endif %}
              {% if stats.audio_total_display or stats.audio_adjusted_display %}
                <p class="text-muted mb-0">
                  {% if stats.audio_total_display %}–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∫–Ω–∏–≥: {{ stats.audio_total_display }}{% endif %}
                  {% if stats.audio_adjusted_display %}<br>–° —É—á—ë—Ç–æ–º —Å–∫–æ—Ä–æ—Å—Ç–∏: {{ stats.audio_adjusted_display }}{% endif %}
                </p>
              {% elif not stats.audio_tracked_display %}
                <p class="text-muted mb-0">–ê—É–¥–∏–æ–∫–Ω–∏–≥–∏ –≤ —ç—Ç–æ—Ç –ø–µ—Ä–∏–æ–¥ –Ω–µ —É—á–∏—Ç—ã–≤–∞–ª–∏—Å—å.</p>
              {% endif %}
            </div>
          </div>
        </div>
        <div class="col-12 col-lg-6 col-xl-3">
          <div class="card border-0 shadow-sm h-100 stat-card" data-delay="400">
            <div class="card-body">
              <h3 class="h6 mb-2">–§–æ—Ä–º–∞—Ç—ã —á—Ç–µ–Ω–∏—è</h3>
              {% if stats.format_labels %}
                <div class="ratio ratio-1x1 chart-container">
                  <canvas id="readingFormatChart"></canvas>
                </div>
              {% else %}
                <p class="text-muted mb-0">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ñ–æ—Ä–º–∞—Ç–∞—Ö –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥.</p>
              {% endif %}
            </div>
          </div>
        </div>
        <div class="col-12 col-lg-6 col-xl-3">
          <div class="card border-0 shadow-sm h-100 stat-card" data-delay="500">
            <div class="card-body">
              <h3 class="h6 mb-2">–ñ–∞–Ω—Ä—ã</h3>
              {% if stats.genre_labels %}
                <div class="ratio ratio-1x1 chart-container">
                  <canvas id="genreChart"></canvas>
                </div>
              {% else %}
                <p class="text-muted mb-0">–ü–æ–∫–∞ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–∏–∞–≥—Ä–∞–º–º—ã.</p>
              {% endif %}
            </div>
          </div>
        </div>
      </div>

      {% with home=stats.home_library %}
        <div class="card border-0 shadow-sm mb-4 stat-card" data-delay="600">
          <div class="card-body">
            <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-3 mb-3">
              <div>
                <h3 class="h6 mb-1">–î–æ–º–∞—à–Ω—è—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞</h3>
                <p class="text-muted mb-0">–û—Ç—Ä–∞–∂–∞–µ—Ç –∫–Ω–∏–≥–∏ –Ω–∞ –ø–æ–ª–∫–µ ¬´–ú–æ—è –¥–æ–º–∞—à–Ω—è—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞¬ª.</p>
              </div>
              <a class="btn btn-outline-primary btn-sm" href="{% url 'shelves:home_library' %}">
                <i class="bi bi-box-seam me-1"></i>–û—Ç–∫—Ä—ã—Ç—å –ø–æ–ª–∫—É
              </a>
            </div>
            {% if home.total %}
              <div class="row g-3">
                <div class="col-12 col-md-3">
                  <div class="border rounded-3 p-3 h-100 bg-body-tertiary">
                    <p class="text-muted text-uppercase small mb-1">–í—Å–µ–≥–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–Ω–∏–≥</p>
                    <p class="fs-3 fw-semibold mb-1 animated-number" data-target="{{ home.total }}">0</p>
                    <p class="small text-muted mb-0">–ü–µ—Ä–µ–¥–∞–Ω–æ: <span class="animated-number" data-target="{{ home.disposed_total }}">0</span> {{ home.disposed_total|ru_pluralize:"–∫–Ω–∏–≥–∞,–∫–Ω–∏–≥–∏,–∫–Ω–∏–≥" }}</p>
                  </div>
                </div>
                <div class="col-12 col-md-3">
                  <div class="border rounded-3 p-3 h-100 bg-body-tertiary">
                    <p class="text-muted text-uppercase small mb-1">–ö–ª–∞—Å—Å–∏–∫–∞</p>
                    <p class="fs-3 fw-semibold mb-1 animated-number" data-target="{{ home.classic_count }}">0</p>
                    <p class="small text-muted mb-0">–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∫–Ω–∏–≥: <span class="animated-number" data-target="{{ home.modern_count }}">0</span></p>
                  </div>
                </div>
                <div class="col-12 col-md-3">
                  <div class="border rounded-3 p-3 h-100 bg-body-tertiary">
                    <p class="text-muted text-uppercase small mb-2">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å–µ—Ä–∏–∏</p>
                    {% if home.series_counts %}
                      <ul class="list-unstyled mb-0 small">
                        {% for series in home.series_counts %}
                          <li class="d-flex justify-content-between">
                            <span>{{ series.series_name }}</span>
                            <span class="fw-semibold animated-number" data-target="{{ series.total }}">0</span>
                          </li>
                        {% endfor %}
                      </ul>
                    {% else %}
                      <p class="text-muted mb-0 small">–î–æ–±–∞–≤—å—Ç–µ —Å–µ—Ä–∏—é –¥–ª—è —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤.</p>
                    {% endif %}
                  </div>
                </div>
                <div class="col-12 col-md-3">
                  <div class="border rounded-3 p-3 h-100 bg-body-tertiary">
                    <p class="text-muted text-uppercase small mb-2">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∂–∞–Ω—Ä—ã</p>
                    {% if home.genre_counts %}
                      <ul class="list-unstyled mb-0 small">
                        {% for genre in home.genre_counts %}
                          <li class="d-flex justify-content-between">
                            <span>{{ genre.name }}</span>
                            <span class="fw-semibold animated-number" data-target="{{ genre.total }}">0</span>
                          </li>
                        {% endfor %}
                      </ul>
                    {% else %}
                      <p class="text-muted mb-0 small">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∂–∞–Ω—Ä—ã —É –∫–Ω–∏–≥.</p>
                    {% endif %}
                  </div>
                </div>
              </div>
              {% if home.top_statuses %}
                <div class="mt-4">
                  <h4 class="h6 mb-2">–°—Ç–∞—Ç—É—Å—ã —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤</h4>
                  <div class="d-flex flex-wrap gap-2">
                    {% for status in home.top_statuses %}
                      <span class="badge text-bg-light">{{ status.status }} ‚Äî <span class="animated-number" data-target="{{ status.total }}">0</span></span>
                    {% endfor %}
                  </div>
                </div>
              {% endif %}
              <div class="mt-4">
                <h4 class="h6 mb-2">–ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è</h4>
                {% if home.top_locations %}
                  <ul class="list-unstyled mb-0 small">
                    {% for loc in home.top_locations %}
                      <li class="d-flex justify-content-between">
                        <span>{{ loc.location }}</span>
                        <span class="fw-semibold animated-number" data-target="{{ loc.total }}">0</span>
                      </li>
                    {% endfor %}
                  </ul>
                {% else %}
                  <p class="text-muted mb-0 small">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–µ ¬´–ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è¬ª.</p>
                {% endif %}
              </div>
            {% else %}
              <p class="text-muted mb-0">–î–æ–±–∞–≤—å—Ç–µ –∫–Ω–∏–≥–∏ –≤ –ø–æ–ª–∫—É ¬´–ú–æ—è –¥–æ–º–∞—à–Ω—è—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞¬ª, —á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–µ.</p>
            {% endif %}
          </div>
        </div>
      {% endwith %}

      <div class="mb-4">
        <h3 class="h6 mb-3">–ü—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –∫–Ω–∏–≥–∏</h3>
        {% if stats.books %}
          <div class="row g-3">
            {% for entry in stats.books %}
              <div class="col-6 col-md-4 col-lg-3">
                <div class="card h-100 border-0 shadow-sm book-card">
                  {% if entry.cover_url %}
                    <img src="{{ entry.cover_url }}" class="card-img-top book-cover" style="height:180px;object-fit:cover" alt="–û–±–ª–æ–∂–∫–∞ –∫–Ω–∏–≥–∏ {{ entry.book.title }}">
                  {% else %}
                    <div class="card-img-top bg-light d-flex align-items-center justify-content-center book-cover" style="height:180px;">
                      <span class="text-muted small">–ù–µ—Ç –æ–±–ª–æ–∂–∫–∏</span>
                    </div>
                  {% endif %}
                  <div class="card-body d-flex flex-column">
                    <h6 class="card-title mb-1">
                      <a class="text-decoration-none" href="{% url 'book_detail' entry.book.pk %}">{{ entry.book.title }}</a>
                    </h6>
                    <p class="small text-muted flex-grow-1 mb-2">{{ entry.format|default:"–§–æ—Ä–º–∞—Ç –Ω–µ –≤—ã–±—Ä–∞–Ω" }}</p>
                    {% if entry.has_review %}
                      <a class="btn btn-outline-primary btn-sm mt-auto" href="{{ entry.review_url }}">–ß–∏—Ç–∞—Ç—å –æ—Ç–∑—ã–≤</a>
                    {% elif request.user == u %}
                      <a class="btn btn-primary btn-sm mt-auto" href="{{ entry.review_url }}">–ù–∞–ø–∏—Å–∞—Ç—å –æ—Ç–∑—ã–≤</a>
                    {% else %}
                      <span class="badge text-bg-light mt-auto align-self-start">–û—Ç–∑—ã–≤ –µ—â—ë –Ω–µ –Ω–∞–ø–∏—Å–∞–Ω</span>
                    {% endif %}
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <p class="text-muted mb-0">–ó–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –∫–Ω–∏–≥ –Ω–µ—Ç.</p>
        {% endif %}
      </div>

      {% if stats.genre_labels or stats.format_labels %}
        {% if stats.genre_labels %}
          {{ stats.genre_labels|json_script:"genre-chart-labels" }}
          {{ stats.genre_values|json_script:"genre-chart-values" }}
        {% endif %}
        {% if stats.format_labels %}
          {{ stats.format_labels|json_script:"reading-format-chart-labels" }}
          {{ stats.format_values|json_script:"reading-format-chart-values" }}
          {{ stats.format_palette|json_script:"reading-format-chart-colors" }}
        {% endif %}
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js" crossorigin="anonymous"></script>
        <script>
          (function(){
            if(typeof Chart==='undefined'){return;}

            const gl=document.getElementById('genre-chart-labels');
            const gv=document.getElementById('genre-chart-values');
            const gc=document.getElementById('genreChart');
            if(gl&&gv&&gc){
              const labels=JSON.parse(gl.textContent);
              const values=JSON.parse(gv.textContent);
              const palette=labels.map((_,i)=>`hsl(${(i*57)%360},70%,55%)`);
              new Chart(gc.getContext('2d'),{
                type:'doughnut',
                data:{labels,datasets:[{data:values,backgroundColor:palette,borderColor:'#fff',borderWidth:2}]},
                options:{responsive:true,plugins:{legend:{position:'bottom'}}}
              });
              gc.parentElement.classList.add('visible');
            }

            const fl=document.getElementById('reading-format-chart-labels');
            const fv=document.getElementById('reading-format-chart-values');
            const fc=document.getElementById('reading-format-chart-colors');
            const fcv=document.getElementById('readingFormatChart');
            if(fl&&fv&&fc&&fcv){
              const labels=JSON.parse(fl.textContent);
              const values=JSON.parse(fv.textContent);
              const colors=JSON.parse(fc.textContent);
              new Chart(fcv.getContext('2d'),{
                type:'doughnut',
                data:{labels,datasets:[{data:values,backgroundColor:colors,borderColor:'#fff',borderWidth:2}]},
                options:{responsive:true,plugins:{legend:{position:'bottom'}}}
              });
              fcv.parentElement.classList.add('visible');
            }
          })();
        </script>
      {% endif %}
    </div>

    <!-- –ú–æ–∏ –∫–Ω–∏–≥–∏ -->
    <div class="tab-pane fade{% if current_tab == 'books' %} show active{% endif %}" id="books" role="tabpanel">
      <div class="d-flex flex-column flex-md-row gap-3 align-items-md-center justify-content-between">
        <div>
          <h3 class="h6 mb-1">–ö–Ω–∏–≥–∏ –∞–≤—Ç–æ—Ä–∞</h3>
          <p class="text-muted small mb-0">–ü–æ–¥–±–æ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–π, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –Ω–∞ —Å–∞–π—Ç —Å–∞–º–∏–º –∞–≤—Ç–æ—Ä–æ–º.</p>
        </div>
        {% if can_manage_author_books %}
          <a class="btn btn-primary btn-sm" href="{% url 'book_create' %}">
            <i class="bi bi-plus-lg me-1"></i>–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É
          </a>
        {% endif %}
      </div>

      {% if author_books %}
        <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 g-3 mt-3">
          {% for book in author_books %}
            <div class="col">
              <div class="card h-100 border-0 shadow-sm book-card">
                {% with cover=book.get_cover_url %}
                  {% if cover %}
                    <img src="{{ cover }}" class="card-img-top book-cover" alt="–û–±–ª–æ–∂–∫–∞ {{ book.title }}">
                  {% else %}
                    <div class="ratio ratio-2x3 bg-light d-flex align-items-center justify-content-center text-muted fw-semibold book-cover">
                      –ë–µ–∑ –æ–±–ª–æ–∂–∫–∏
                    </div>
                  {% endif %}
                {% endwith %}
                <div class="card-body d-flex flex-column">
                  <h3 class="h6 mb-1">
                    <a class="text-decoration-none" href="{% url 'book_detail' book.pk %}">{{ book.title }}</a>
                  </h3>
                  {% with book_authors=book.authors.all %}
                    <p class="text-muted small mb-3">
                      {% if book_authors %}
                        {{ book_authors|join:", " }}
                      {% else %}
                        –ê–≤—Ç–æ—Ä –Ω–µ —É–∫–∞–∑–∞–Ω
                      {% endif %}
                    </p>
                  {% endwith %}
                  <div class="mt-auto d-flex flex-wrap gap-2">
                    <a class="btn btn-outline-primary btn-sm" href="{% url 'book_detail' book.pk %}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</a>
                    {% if can_manage_author_books %}
                      <a class="btn btn-outline-secondary btn-sm" href="{% url 'book_edit' book.pk %}">
                        <i class="bi bi-pencil me-1"></i>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                      </a>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="alert alert-light border mt-3 mb-0">
          {% if is_author %}
            {% if can_manage_author_books %}
              –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –∫–Ω–∏–≥. –ù–∞–∂–º–∏—Ç–µ ¬´–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É¬ª, —á—Ç–æ–±—ã –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø–µ—Ä–≤—É—é.
            {% else %}
              –ê–≤—Ç–æ—Ä –ø–æ–∫–∞ –Ω–µ –¥–æ–±–∞–≤–∏–ª —Å–≤–æ–∏ –∫–Ω–∏–≥–∏.
            {% endif %}
          {% else %}
            –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–∫–∞ –Ω–µ —É–∫–∞–∑–∞–ª —Å–≤–æ–∏ –∫–Ω–∏–≥–∏.
          {% endif %}
        </div>
      {% endif %}
    </div>

    <!-- –û–±–∑–æ—Ä—ã -->
    <div class="tab-pane fade{% if current_tab == 'reviews' %} show active{% endif %}" id="reviews" role="tabpanel">
      {% if user_reviews %}
        <div class="d-flex flex-column gap-3">
          {% for review in user_reviews %}
            <div class="card border-0 shadow-sm review-card">
              <div class="card-body">
                <div class="d-flex flex-column flex-md-row gap-3 align-items-start">
                  <div id="review-print-{{ review.id }}" class="flex-grow-1">
                    <div class="d-flex flex-wrap align-items-baseline gap-2 mb-1">
                      <h3 class="h6 mb-0">
                        <a class="text-decoration-none" href="{% url 'book_detail' review.book.pk %}">{{ review.book.title }}</a>
                      </h3>
                      {% with authors=review.book.authors.all %}
                        {% if authors %}
                          <span class="text-muted small">{{ authors|join:", " }}</span>
                        {% endif %}
                      {% endwith %}
                      {% if review.score %}
                        <span class="badge text-bg-warning ms-md-auto">{{ review.score }} / 10</span>
                      {% endif %}
                    </div>
                    <div class="small text-muted mb-2">–û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω {{ review.created_at|date:"d.m.Y H:i" }}</div>
                    {% with category_scores=review.get_category_scores %}
                      {% if category_scores %}
                        <ul class="list-inline small text-muted mb-2">
                          {% for label, value in category_scores %}
                            <li class="list-inline-item me-3">{{ label }}: <strong>{{ value }}</strong></li>
                          {% endfor %}
                        </ul>
                      {% endif %}
                    {% endwith %}
                    {% if review.review %}
                      <div class="mt-2">{{ review.review|linebreaksbr }}</div>
                    {% endif %}
                  </div>
                  <div class="ms-md-auto">
                    <a class="btn btn-outline-secondary btn-sm" href="{% url 'book_review_print' review.book.pk %}" target="_blank" rel="noopener">
                      <i class="bi bi-printer me-1"></i>–†–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å
                    </a>
                  </div>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <div class="alert alert-light border mb-0">–ü–æ–∫–∞ –Ω–µ—Ç –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã—Ö –æ—Ç–∑—ã–≤–æ–≤.</div>
      {% endif %}
    </div>
  </div>
  {% endwith %}

</div><!-- /.profile-theme -->

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –¥–µ—Ç–∞–ª—è–º–∏ –¥–Ω—è -->
<div class="modal fade profile-day-modal" id="readingDayModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="dayModalTitle">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –¥–µ–Ω—å</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä—ã—Ç—å"></button>
      </div>
      <div class="modal-body">
        <div class="row g-3 mb-4">
          <div class="col-12 col-md-4">
            <div class="stat-item">
              <div class="stat-value" id="dayModalPages">0</div>
              <div class="stat-label">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ —Å—Ç—Ä–∞–Ω–∏—Ü</div>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="stat-item">
              <div class="stat-value" id="dayModalBooks">0</div>
              <div class="stat-label">–ö–Ω–∏–≥–∏ –¥–Ω—è</div>
            </div>
          </div>
          <div class="col-12 col-md-4">
            <div class="stat-item">
              <div class="stat-value" id="dayModalSessions">0</div>
              <div class="stat-label">–ó–∞–ø–∏—Å–µ–π —á—Ç–µ–Ω–∏—è</div>
            </div>
          </div>
        </div>
        <div class="mb-3" id="dayModalAudioWrapper" hidden>
          <span class="badge text-bg-light text-dark"><i class="bi bi-headphones me-1"></i><span id="dayModalAudio"></span></span>
        </div>
        <div class="mb-3">
          <h6 class="mb-2">–ü—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –∫–Ω–∏–≥–∏</h6>
          <div class="day-books-grid" id="dayModalBooksList"></div>
          <p class="text-muted small mb-0" id="dayModalEmptyMessage" hidden>–í —ç—Ç–æ—Ç –¥–µ–Ω—å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π —á—Ç–µ–Ω–∏—è.</p>
        </div>
        <div class="d-flex justify-content-end gap-2 mt-4">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">–ó–∞–∫—Ä—ã—Ç—å</button>
          <a href="#" class="btn btn-primary" id="dayModalDetailLink" target="_self">–û—Ç–∫—Ä—ã—Ç—å –ø–æ–¥—Ä–æ–±–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
<div class="profile-notification" id="profileNotification">
  <div class="d-flex align-items-center">
    <i class="bi bi-info-circle me-2"></i>
    <span id="notificationText"></span>
  </div>
</div>

<!-- Yandex.RTB R-A-17641153-4 -->
<script>
window.yaContextCb.push(() => {
    Ya.Context.AdvManager.render({
        "blockId": "R-A-17641153-4",
        "type": "floorAd",
        "platform": "touch"
    })
})
</script>
{% endblock %}

{% block extra_js %}
  {{ block.super }}
   <script>
    // –ê–Ω–∏–º–∞—Ü–∏—è —á–∏—Å–µ–ª
    function setupAnimatedNumbers() {
      const numberElements = Array.from(document.querySelectorAll('.animated-number'));
      if (!numberElements.length) {
        return;
      }

      const parseTargetValue = (el) => {
        const raw = (el.dataset.target || '0').toString().replace(',', '.');
        const parsed = Number.parseFloat(raw);
        if (!Number.isFinite(parsed)) {
          return 0;
        }
        return parsed;
      };

      const getDecimals = (el) => {
        const raw = el.dataset.decimals;
        const decimals = Number.parseInt(raw || '0', 10);
        return Number.isFinite(decimals) && decimals > 0 ? decimals : 0;
      };

      const formatNumber = (value, decimals) => {
        const formatter = new Intl.NumberFormat('ru-RU', {
          minimumFractionDigits: decimals,
          maximumFractionDigits: decimals,
        });
        return formatter.format(value);
      };

      const animateValue = (element, target, duration, decimals) => {
        const startValue = 0;
        const delta = target - startValue;
        const formatter = new Intl.NumberFormat('ru-RU', {
          minimumFractionDigits: decimals,
          maximumFractionDigits: decimals,
        });

        if (!Number.isFinite(delta) || duration <= 0 || Math.abs(delta) < 0.0001) {
          element.textContent = formatter.format(target);
          return;
        }

        let startTimestamp = null;
        const step = (timestamp) => {
          if (!startTimestamp) {
            startTimestamp = timestamp;
          }
          const progress = Math.min((timestamp - startTimestamp) / duration, 1);
          const current = startValue + delta * progress;
          const valueForDisplay = progress < 1 ? current : target;
          element.textContent = formatter.format(valueForDisplay);
          if (progress < 1) {
            window.requestAnimationFrame(step);
          }
        };

        element.textContent = formatter.format(startValue);
        window.requestAnimationFrame(step);
      };

      if (!('IntersectionObserver' in window)) {
        numberElements.forEach((el) => {
          const decimals = getDecimals(el);
          const target = parseTargetValue(el);
          el.textContent = formatNumber(target, decimals);
        });
        return;
      }

      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (!entry.isIntersecting) {
            return;
          }
          const element = entry.target;
          const decimals = getDecimals(element);
          const target = parseTargetValue(element);
          if (Math.abs(target) < 0.0001) {
            element.textContent = formatNumber(0, decimals);
          } else {
            animateValue(element, target, 2000, decimals);
          }
          observer.unobserve(element);
        });
      }, { threshold: 0.1 });

      numberElements.forEach((el) => observer.observe(el));
    }

    setupAnimatedNumbers();

    let calendarDayData = {};
    const calendarDayDataElement = document.getElementById('profile-calendar-day-data');
    if (calendarDayDataElement) {
      try {
        calendarDayData = JSON.parse(calendarDayDataElement.textContent || '{}');
      } catch (error) {
        console.warn('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–æ–±—Ä–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è', error);
        calendarDayData = {};
      }
    }

    const numberFormatter = new Intl.NumberFormat('ru-RU');

    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫
    const cardObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const card = entry.target;
          const delay = parseInt(card.dataset.delay) || 0;
          setTimeout(() => {
            card.classList.add('visible');
          }, delay);
          cardObserver.unobserve(card);
        }
      });
    }, { threshold: 0.1 });

    document.querySelectorAll('.stat-card').forEach(card => {
      cardObserver.observe(card);
    });

    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –æ—Ç–∑—ã–≤–æ–≤
    const reviewObserver = new IntersectionObserver((entries) => {
      entries.forEach((entry, index) => {
        if (entry.isIntersecting) {
          setTimeout(() => {
            entry.target.classList.add('visible');
          }, index * 200);
          reviewObserver.unobserve(entry.target);
        }
      });
    }, { threshold: 0.1 });

    document.querySelectorAll('.review-card').forEach(card => {
      reviewObserver.observe(card);
    });

    // –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
    function showProfileNotification(message) {
      const notification = document.getElementById('profileNotification');
      const text = document.getElementById('notificationText');
      
      if (notification && text) {
        text.textContent = message;
        notification.classList.add('show');
        
        setTimeout(() => {
          notification.classList.remove('show');
        }, 3000);
      }
    }

     // –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–æ–¥—Ä–æ–±–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–Ω—è
    function buildDayDetailUrl(isoDate) {
      const url = new URL(window.location.href);
      const [year, month] = (isoDate || '').split('-');

      url.searchParams.set('tab', 'stats');
      url.searchParams.set('period', 'day');
      url.searchParams.set('date', isoDate);

      if (year) {
        url.searchParams.set('year', year);
        url.searchParams.set('calendar_year', year);
      }

      if (month) {
        const monthNumber = String(Number.parseInt(month, 10));
        url.searchParams.set('month', monthNumber);
        url.searchParams.set('calendar_month', monthNumber);
      }

      return url.toString();
    }

    function renderDayBooks(listElement, books) {
      listElement.innerHTML = '';
      if (!books || !books.length) {
        return;
      }

      books.forEach((book) => {
        const card = document.createElement('div');
        card.className = 'day-book';

        const wrapper = document.createElement('div');
        wrapper.className = 'd-flex gap-3 align-items-start';

        if (book.cover_url) {
          const cover = document.createElement('img');
          cover.src = book.cover_url;
          cover.alt = `–û–±–ª–æ–∂–∫–∞ ${book.title}`;
          cover.className = 'day-book-cover flex-shrink-0';
          wrapper.appendChild(cover);
        }

        const textContainer = document.createElement('div');
        textContainer.className = 'flex-grow-1';

        const titleEl = document.createElement('div');
        titleEl.className = 'fw-semibold mb-1';
        if (book.detail_url) {
          const link = document.createElement('a');
          link.href = book.detail_url;
          link.textContent = book.title;
          link.className = 'text-decoration-none';
          titleEl.appendChild(link);
        } else {
          titleEl.textContent = book.title;
        }
        textContainer.appendChild(titleEl);

        if (book.authors && book.authors.length) {
          const authorsEl = document.createElement('div');
          authorsEl.className = 'small text-muted';
          authorsEl.textContent = book.authors.join(', ');
          textContainer.appendChild(authorsEl);
        }

        if (book.is_completion) {
          const badge = document.createElement('span');
          badge.className = 'badge text-bg-success mt-2';
          badge.textContent = '–ó–∞–≤–µ—Ä—à–µ–Ω–∞';
          textContainer.appendChild(badge);
        }

        wrapper.appendChild(textContainer);
        card.appendChild(wrapper);
        listElement.appendChild(card);
      });
    }

    function openDayModal(isoDate) {
      const payload = calendarDayData[isoDate];
      if (!payload) {
        window.location.assign(buildDayDetailUrl(isoDate));
        return;
      }

      const modalElement = document.getElementById('readingDayModal');
      const titleElement = document.getElementById('dayModalTitle');
      const pagesElement = document.getElementById('dayModalPages');
      const booksElement = document.getElementById('dayModalBooks');
      const sessionsElement = document.getElementById('dayModalSessions');
      const audioWrapper = document.getElementById('dayModalAudioWrapper');
      const audioElement = document.getElementById('dayModalAudio');
      const listElement = document.getElementById('dayModalBooksList');
      const emptyMessage = document.getElementById('dayModalEmptyMessage');
      const detailLink = document.getElementById('dayModalDetailLink');

      if (!modalElement || !titleElement || !pagesElement || !booksElement || !sessionsElement || !listElement || !emptyMessage || !detailLink) {
        window.location.assign(buildDayDetailUrl(isoDate));
        return;
      }

      titleElement.textContent = `–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ ${payload.date_display || isoDate}`;
      pagesElement.textContent = numberFormatter.format(payload.pages_total || 0);
      booksElement.textContent = numberFormatter.format(payload.books_count || 0);
      sessionsElement.textContent = numberFormatter.format(payload.reading_sessions || 0);

      if (payload.audio_display) {
        audioElement.textContent = payload.audio_display;
        audioWrapper.hidden = false;
      } else {
        audioWrapper.hidden = true;
      }

      renderDayBooks(listElement, payload.books || []);
      const hasBooks = Boolean(payload.books && payload.books.length);
      emptyMessage.hidden = hasBooks;
      detailLink.href = buildDayDetailUrl(isoDate);

      const modal = bootstrap.Modal.getOrCreateInstance(modalElement);
      modal.show();
    }

    // –î–µ—Ç–∞–ª–∏ –¥–Ω—è –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ
    function showDayDetails(isoDate) {
      if (!isoDate) {
        return;
      }

      if (calendarDayData && Object.prototype.hasOwnProperty.call(calendarDayData, isoDate)) {
        openDayModal(isoDate);
        return;
      }

      window.location.assign(buildDayDetailUrl(isoDate));
    }

    // –ü–∞—Ä–∞–ª–ª–∞–∫—Å —ç—Ñ—Ñ–µ–∫—Ç –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
    window.addEventListener('scroll', () => {
      const scrolled = window.pageYOffset;
      const parallaxElements = document.querySelectorAll('.parallax-header');
      
      parallaxElements.forEach(element => {
        const speed = 0.5;
        element.style.transform = `translateY(${scrolled * speed}px)`;
      });
    });

    // –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
    document.querySelectorAll('#profileTabs .nav-link').forEach(tab => {
      tab.addEventListener('click', function() {
        // –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∫–ª–∞–¥–æ–∫
        showProfileNotification(`–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞: ${this.textContent.trim()}`);
      });
    });

    // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç—ã —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    document.querySelectorAll('.stat-card').forEach(card => {
      card.addEventListener('mouseenter', function() {
        this.style.transform = 'translateY(-10px) scale(1.02)';
      });
      
      card.addEventListener('mouseleave', function() {
        this.style.transform = 'translateY(-5px) scale(1)';
      });
    });

    // –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–≥—Ä–µ—Å—Å —á—Ç–µ–Ω–∏—è
    function updateReadingProgress() {
      const progressBars = document.querySelectorAll('.progress-bar-animated');
      progressBars.forEach(bar => {
        const currentWidth = parseFloat(bar.style.width) || 0;
        const targetWidth = parseFloat(bar.getAttribute('data-target-width')) || 100;
        
        if (currentWidth < targetWidth) {
          bar.style.width = targetWidth + '%';
        }
      });
    }

    // –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    document.addEventListener('DOMContentLoaded', function() {
      const periodFallbacks = document.querySelectorAll('.period-select-fallback');
      periodFallbacks.forEach(el => el.classList.add('d-none'));

      const periodTabs = document.querySelectorAll('.period-tab');
      const periodSelect = document.getElementById('id_period');
      const periodForm = document.getElementById('statsFilterForm');

      periodTabs.forEach((tab) => {
        tab.addEventListener('click', () => {
          if (!periodSelect) {
            return;
          }
          const targetPeriod = tab.dataset.period;
          if (!targetPeriod) {
            return;
          }
          const shouldSubmit = periodSelect.value !== targetPeriod;
          periodSelect.value = targetPeriod;
          periodTabs.forEach((btn) => {
            const isActive = btn === tab;
            btn.classList.toggle('active', isActive);
            btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');
          });
          if (shouldSubmit && periodForm) {
            periodForm.submit();
          }
        });
      });

      document.querySelectorAll('td[data-date]').forEach((cell) => {
        cell.addEventListener('keydown', (event) => {
          if (event.key === 'Enter' || event.key === ' ') {
            event.preventDefault();
            const isoDate = cell.dataset.date;
            showDayDetails(isoDate);
          }
        });
      });

      // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è
      setTimeout(() => {
        updateReadingProgress();

        // –ê–Ω–∏–º–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
        const charts = document.querySelectorAll('.chart-container');
        charts.forEach((chart, index) => {
          setTimeout(() => {
            chart.classList.add('visible');
          }, index * 300);
        });
      }, 500);

      // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      setTimeout(() => {
        showProfileNotification('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –≤–∞—à –ø—Ä–æ—Ñ–∏–ª—å! üåü –ò—Å—Å–ª–µ–¥—É–π—Ç–µ —Å–≤–æ—é —á–∏—Ç–∞—Ç–µ–ª—å—Å–∫—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É.');
      }, 1000);
    });

    // –≠—Ñ—Ñ–µ–∫—Ç –ø–µ—á–∞—Ç–Ω–æ–π –º–∞—à–∏–Ω–∫–∏ –¥–ª—è –±–∏–æ
    function typeWriter(element, text, speed = 50) {
      let i = 0;
      element.innerHTML = '';
      
      function type() {
        if (i < text.length) {
          element.innerHTML += text.charAt(i);
          i++;
          setTimeout(type, speed);
        }
      }
      type();
    }

    // –ü—Ä–∏–º–µ–Ω–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç –ø–µ—á–∞—Ç–Ω–æ–π –º–∞—à–∏–Ω–∫–∏ –∫ –±–∏–æ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
    const bioElement = document.querySelector('.profile-header p.mb-1');
    if (bioElement && bioElement.textContent !== '–ü–æ–∫–∞ –±–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è.') {
      const originalBio = bioElement.textContent;
      bioElement.textContent = '';
      setTimeout(() => {
        typeWriter(bioElement, originalBio, 30);
      }, 1500);
    }
  </script>
{% endblock %}