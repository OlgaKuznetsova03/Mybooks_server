{% extends "base.html" %}
{% load static %}
{% block title %}–ß–∏—Ç–∞—é —Å–µ–π—á–∞—Å ¬∑ –ö–∞–ª–µ–π–¥–æ—Å–∫–æ–ø –∫–Ω–∏–≥{% endblock %}
{% block body_class %} reading-now-page{% endblock %}

{% block extra_css %}
{{ block.super }}
<style>
  /* –ò–º–ø–æ—Ä—Ç –∞–Ω–∏–º–∞—Ü–∏–π –∏–∑ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
  @keyframes fadeInUp {
    from { opacity: 0; transform: translateY(50px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-20px); }
  }

  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }

  @keyframes glow {
    0%, 100% { box-shadow: 0 0 20px rgba(171, 120, 67, 0.3); }
    50% { box-shadow: 0 0 40px rgba(171, 120, 67, 0.6); }
  }

  @keyframes shimmer {
    0% { background-position: -1000px 0; }
    100% { background-position: 1000px 0; }
  }

  @keyframes bookFlip {
    0% { transform: perspective(1000px) rotateY(0deg); }
    50% { transform: perspective(1000px) rotateY(10deg); }
    100% { transform: perspective(1000px) rotateY(0deg); }
  }

  .animate-fade-in { animation: fadeInUp 0.8s ease-out forwards; }
  .animate-float { animation: float 3s ease-in-out infinite; }
  .animate-pulse { animation: pulse 2s ease-in-out infinite; }
  .animate-glow { animation: glow 2s ease-in-out infinite; }
  .animate-book { animation: bookFlip 3s ease-in-out infinite; }

  /* Hero Section –∫–∞–∫ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π */
  .hero-section {
    background: 
      radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.8) 0%, transparent 50%),
      radial-gradient(circle at 80% 20%, rgba(171, 120, 67, 0.1) 0%, transparent 50%),
      radial-gradient(circle at top right, rgba(255, 255, 255, 0.65), transparent 55%), 
      #d7bda6;
    border-radius: 2.5rem;
    padding: clamp(2.5rem, 6vw, 4rem);
    color: #2f1d0f;
    box-shadow: 0 2.75rem 4rem rgba(77, 54, 28, 0.15);
    position: relative;
    overflow: hidden;
    opacity: 0;
    animation: fadeInUp 1s ease-out 0.3s forwards;
    margin-bottom: 2.5rem;
  }

  .hero-section::before {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    animation: shimmer 3s ease-in-out infinite;
  }

  .hero-section::after {
    content: "";
    position: absolute;
    inset: 1.5rem;
    border-radius: 2rem;
    border: 1px solid rgba(255, 255, 255, 0.35);
    pointer-events: none;
  }

  /* –ö–∞—Ä—Ç–æ—á–∫–∏ –∫–Ω–∏–≥ –≤ —Å—Ç–∏–ª–µ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
  .reading-cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
  }

  @media (max-width: 768px) {
    .reading-cards-grid {
      grid-template-columns: 1fr;
    }
  }

  .reading-card {
    background: rgba(255, 255, 255, 0.9);
    border-radius: 1.5rem;
    padding: 1.75rem;
    box-shadow: 0 20px 40px rgba(77, 54, 28, 0.12);
    border: 1px solid rgba(171, 120, 67, 0.2);
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    cursor: pointer;
    position: relative;
    overflow: hidden;
    opacity: 0;
    animation: fadeInUp 0.6s ease-out forwards;
    animation-delay: calc(var(--card-index, 0) * 0.1s + 0.5s);
  }

  .reading-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(171, 120, 67, 0.1), transparent);
    transition: left 0.6s ease;
  }

  .reading-card:hover::before {
    left: 100%;
  }

  .reading-card:hover {
    transform: translateY(-10px) scale(1.02);
    box-shadow: 
      inset 0 0 0 1px rgba(171, 120, 67, 0.3),
      0 25px 50px rgba(77, 54, 28, 0.2);
    background: rgba(255, 255, 255, 0.95);
  }

  .reading-card-header {
    display: flex;
    align-items: flex-start;
    gap: 1.25rem;
    margin-bottom: 1.5rem;
  }

  .reading-card-cover {
    width: 80px;
    height: 120px;
    flex-shrink: 0;
    border-radius: 0.75rem;
    overflow: hidden;
    background: #f3ece4;
    box-shadow:
      inset 0 0 0 1px rgba(171, 120, 67, 0.2),
      0 10px 20px rgba(77, 54, 28, 0.18);
    position: relative;
    animation: bookFlip 4s ease-in-out infinite;
  }

  .reading-card:hover .reading-card-cover {
    animation: none;
    transform: perspective(1000px) rotateY(15deg) scale(1.1);
  }

  .reading-card-cover img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .reading-card-title {
    flex: 1;
  }

  .reading-card-title h3 {
    margin: 0 0 0.5rem;
    font-weight: 700;
    color: #2f1d0f;
    font-size: 1.25rem;
  }

  .reading-card-authors {
    color: #6f5843;
    font-size: 0.95rem;
  }

  .reading-badge {
    display: inline-block;
    background: linear-gradient(135deg, #ab7843, #d7bda6);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 999px;
    font-size: 0.8rem;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(171, 120, 67, 0.25);
  }

  .reading-progress {
    margin-bottom: 1.5rem;
  }

  .reading-progress-bar {
    height: 12px;
    border-radius: 999px;
    background: rgba(215, 189, 166, 0.2);
    overflow: hidden;
    border: 1px solid rgba(171, 120, 67, 0.1);
  }

  .reading-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #ab7843, #d7bda6);
    border-radius: 999px;
    transition: width 1s ease-out;
    position: relative;
    overflow: hidden;
  }

  .reading-progress-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    animation: shimmer 2s infinite;
  }

  .reading-progress-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 0.5rem;
    color: #6f5843;
    font-size: 0.9rem;
  }

  .reading-progress-percent {
    font-weight: 700;
    font-size: 1.1rem;
    color: #ab7843;
  }

  .reading-card-actions {
    display: flex;
    gap: 0.75rem;
    margin-top: 1.5rem;
  }

  .btn-track {
    flex: 1;
    background: linear-gradient(135deg, #ab7843, #d7bda6);
    border: none;
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: 0.85rem;
    font-weight: 600;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .btn-track:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(171, 120, 67, 0.4);
  }

  .btn-track::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
    transition: left 0.5s;
  }

  .btn-track:hover::before {
    left: 100%;
  }

  .btn-details {
    flex: 1;
    background: transparent;
    border: 2px solid #ab7843;
    color: #ab7843;
    padding: 0.75rem 1.5rem;
    border-radius: 0.85rem;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .btn-details:hover {
    background: rgba(171, 120, 67, 0.1);
    transform: translateY(-2px);
  }

  /* Empty state */
  .reading-empty {
    text-align: center;
    padding: 4rem 2rem;
    background: rgba(255, 255, 255, 0.8);
    border-radius: 2rem;
    box-shadow: 0 20px 40px rgba(77, 54, 28, 0.1);
    opacity: 0;
    animation: fadeInUp 0.8s ease-out 0.5s forwards;
  }

  .reading-empty-icon {
    font-size: 4rem;
    margin-bottom: 1.5rem;
    animation: float 3s ease-in-out infinite;
  }

  .reading-empty h2 {
    color: #2f1d0f;
    margin-bottom: 1rem;
  }

  .reading-empty p {
    color: #6f5843;
    max-width: 500px;
    margin: 0 auto 2rem;
  }

  .btn-start-reading {
    background: linear-gradient(135deg, #ab7843, #d7bda6);
    border: none;
    color: white;
    padding: 1rem 2rem;
    border-radius: 1rem;
    font-weight: 600;
    font-size: 1.1rem;
    transition: all 0.3s ease;
  }

  .btn-start-reading:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 30px rgba(171, 120, 67, 0.3);
  }

  /* Ripple —ç—Ñ—Ñ–µ–∫—Ç –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
  .ripple {
    position: absolute;
    border-radius: 50%;
    background-color: rgba(255, 255, 255, 0.7);
    transform: scale(0);
    animation: ripple 0.6s linear;
  }

  @keyframes ripple {
    to {
      transform: scale(4);
      opacity: 0;
    }
  }

  .btn-track, .btn-details, .btn-start-reading {
    position: relative;
    overflow: hidden;
  }
</style>
{% endblock %}

{% block content %}

<section class="hero-section">
  <div class="d-flex flex-column gap-4">
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
      <div>
        <p class="text-muted mb-1">–í–∞—à–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–∏–≥–∏</p>
        <h1 class="h3 mb-0">–ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ —á–∏—Ç–∞—Ç—å –∫–Ω–∏–≥–∏ –Ω–∞ –ø–æ–ª–∫–µ</h1>
      </div>
      <a class="btn btn-outline-dark btn-magic" href="{% url 'shelves:reading_feed' %}">
        <i class="bi bi-activity me-2"></i>–õ–µ–Ω—Ç–∞ —á—Ç–µ–Ω–∏—è
      </a>
    </div>
  </div>
</section>

{% if items %}
  <div class="reading-cards-grid">
    {% for it in items %}
      <article class="reading-card" style="--card-index: {{ forloop.counter0 }}">
        <div class="reading-card-header">
          <div class="reading-card-cover">
            {% with cover_url=it.book.get_cover_url %}
              {% if cover_url %}
                <img src="{{ cover_url }}" alt="–û–±–ª–æ–∂–∫–∞ {{ it.book.title }}" loading="lazy" />
              {% else %}
                <img src="{% static 'books/cover-placeholder-2x3.png' %}" alt="–ù–µ—Ç –æ–±–ª–æ–∂–∫–∏" />
              {% endif %}
            {% endwith %}
          </div>
          
          <div class="reading-card-title">
            <h3>{{ it.book.title }}</h3>
            {% with authors=it.book.authors.all %}
              {% if authors %}
                <div class="reading-card-authors">{{ authors|join:", " }}</div>
              {% endif %}
            {% endwith %}
            <span class="reading-badge">–ß–∏—Ç–∞—é</span>
          </div>
        </div>

        {% if it.progress %}
          <div class="reading-progress">
            <div class="reading-progress-bar">
              <div class="reading-progress-fill" style="width: {{ it.progress_percent|floatformat:'0' }}%"></div>
            </div>
            <div class="reading-progress-info">
              <span class="reading-progress-percent">{{ it.progress_percent|floatformat:"0" }}%</span>
              {% if it.progress_current_page %}
                <span>{{ it.progress_current_page }} —Å—Ç—Ä.</span>
              {% elif it.progress_total_pages %}
                <span>{{ it.progress_total_pages }} —Å—Ç—Ä.</span>
              {% endif %}
            </div>
          </div>
        {% else %}
          <div class="reading-progress">
            <p class="text-muted mb-3">–î–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å, —á—Ç–æ–±—ã —Ç—Ä–µ–∫–µ—Ä –ø–æ–¥—Å—Ç—Ä–æ–∏–ª—Å—è –ø–æ–¥ –≤–∞—Å.</p>
          </div>
        {% endif %}

        <div class="reading-card-actions">
          <a class="btn btn-track" href="{% url 'shelves:reading_track' it.book.id %}">
            <i class="bi bi-graph-up-arrow me-1"></i>–ö —Ç—Ä–µ–∫–µ—Ä—É
          </a>
          <a class="btn btn-details" href="{% url 'book_detail' it.book.id %}">
            <i class="bi bi-info-circle me-1"></i>–ü–æ–¥—Ä–æ–±–Ω–µ–µ
          </a>
        </div>
      </article>
    {% endfor %}
  </div>
{% else %}
  <div class="reading-empty">
    <div class="reading-empty-icon">üìö</div>
    <h2>–ü–æ–∫–∞ –∑–¥–µ—Å—å –ø—É—Å—Ç–æ</h2>
    <p>–î–æ–±–∞–≤—å—Ç–µ –∫–Ω–∏–≥–∏ –Ω–∞ –ø–æ–ª–∫—É ¬´–ß–∏—Ç–∞—é¬ª, —á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –ø–æ–ª—É—á–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.</p>
    <div class="d-flex justify-content-center gap-2 flex-wrap">
      <a class="btn btn-start-reading" href="{% url 'shelves:home_library' %}">
        <i class="bi bi-plus-circle me-2"></i>–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥–∏
      </a>
      <a class="btn btn-details" href="{% url 'shelves:my_shelves' %}">
        <i class="bi bi-archive me-2"></i>–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–ª–∫–∞–º
      </a>
    </div>
  </div>
{% endif %}

{% endblock %}

{% block extra_js %}
{{ block.super }}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Ripple —ç—Ñ—Ñ–µ–∫—Ç –¥–ª—è –∫–Ω–æ–ø–æ–∫
    function createRipple(event) {
      const button = event.currentTarget;
      const circle = document.createElement("span");
      const diameter = Math.max(button.clientWidth, button.clientHeight);
      const radius = diameter / 2;

      circle.style.width = circle.style.height = `${diameter}px`;
      circle.style.left = `${event.clientX - button.offsetLeft - radius}px`;
      circle.style.top = `${event.clientY - button.offsetTop - radius}px`;
      circle.classList.add("ripple");

      const ripple = button.getElementsByClassName("ripple")[0];
      if (ripple) {
        ripple.remove();
      }

      button.appendChild(circle);
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ ripple —ç—Ñ—Ñ–µ–∫—Ç–∞ –∫–æ –≤—Å–µ–º –∫–Ω–æ–ø–∫–∞–º
    const buttons = document.querySelectorAll('.btn-track, .btn-details, .btn-start-reading');
    buttons.forEach(button => {
      button.addEventListener('click', createRipple);
    });

    // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–≤ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ
    function animateProgressBars() {
      const progressBars = document.querySelectorAll('.reading-progress-fill');
      progressBars.forEach(bar => {
        const width = bar.style.width;
        bar.style.width = '0%';
        setTimeout(() => {
          bar.style.width = width;
        }, 300);
      });
    }

    // –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–≤
    setTimeout(animateProgressBars, 1000);

    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫
    const cards = document.querySelectorAll('.reading-card');
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.style.animationPlayState = 'running';
        }
      });
    }, { threshold: 0.1 });

    cards.forEach(card => {
      card.style.animationPlayState = 'paused';
      observer.observe(card);
    });

    // –ü–∞—Ä–∞–ª–ª–∞–∫—Å —ç—Ñ—Ñ–µ–∫—Ç –¥–ª—è hero section
    window.addEventListener('scroll', () => {
      const scrolled = window.pageYOffset;
      const hero = document.querySelector('.hero-section');
      if (hero) {
        hero.style.transform = `translateY(${scrolled * 0.5}px)`;
      }
    });
  });
</script>
{% endblock %}