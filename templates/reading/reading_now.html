{% extends "base.html" %}
{% block title %}–ß–∏—Ç–∞—é —Å–µ–π—á–∞—Å{% endblock %}
{% block content %}
<div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-lg-between gap-2 mb-4">
  <div>
    <h1 class="h4 mb-1">–ß–∏—Ç–∞—é —Å–µ–π—á–∞—Å</h1>
    <p class="text-muted mb-0">–í–∞—à–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–∏–≥–∏ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º –∏ —Ñ–æ—Ä–º–∞—Ç–æ–º —á—Ç–µ–Ω–∏—è.</p>
  </div>
  <a class="btn btn-outline-primary" href="{% url 'reading_feed' %}">
    –õ–µ–Ω—Ç–∞ —á—Ç–µ–Ω–∏—è
  </a>
</div>

{% if not shelf or not items %}
  <div class="alert alert-light border d-flex align-items-center gap-3">
    <div class="flex-shrink-0 bg-light text-primary rounded-circle d-flex align-items-center justify-content-center" style="width:48px;height:48px;">
      <span class="fs-4" aria-hidden="true">üìö</span>
      <span class="visually-hidden">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–Ω–∏–≥</span>
    </div>
    <div>
      <h2 class="h6 mb-1">–ü–æ–∫–∞ –∑–¥–µ—Å—å –ø—É—Å—Ç–æ</h2>
      <p class="mb-0 text-muted">–î–æ–±–∞–≤—å—Ç–µ –∫–Ω–∏–≥–∏ –Ω–∞ –ø–æ–ª–∫—É ¬´–ß–∏—Ç–∞—é¬ª, —á—Ç–æ–±—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å.</p>
    </div>
  </div>
{% else %}
  <div class="row g-4">
    {% for it in items %}
      <div class="col-12 col-md-6 col-xl-4">
        <div class="card h-100 border-0 shadow-sm overflow-hidden">
          <div class="position-relative">
            {% with cover_url=it.book.get_cover_url %}
              {% if cover_url %}
                <img src="{{ cover_url }}" class="w-100" style="height:220px;object-fit:cover;" alt="–û–±–ª–æ–∂–∫–∞ –∫–Ω–∏–≥–∏ {{ it.book.title }}">
              {% else %}
                <div class="w-100 bg-gradient" style="height:220px;background:linear-gradient(135deg,#f3f6ff,#e6ebff);"></div>
              {% endif %}
            {% endwith %}
            <div class="position-absolute top-0 start-0 p-2">
              <span class="badge bg-dark bg-opacity-75 text-light">–ß–∏—Ç–∞—é</span>
            </div>
          </div>
          <div class="card-body d-flex flex-column">
            <div class="mb-3">
              <h2 class="h6 mb-1">
                <a class="text-decoration-none" href="{% url 'book_detail' it.book.id %}">{{ it.book.title }}</a>
              </h2>
              {% with authors=it.book.authors.all %}
                {% if authors %}
                  <div class="small text-muted">{{ authors|join:", " }}</div>
                {% endif %}
              {% endwith %}
            </div>

            {% if it.progress %}
              <div class="small text-muted mb-2">
                {{ it.progress_label }}
                {% if it.progress_updated_at %}
                  ¬∑ –æ–±–Ω–æ–≤–ª–µ–Ω–æ {{ it.progress_updated_at|date:"d.m.Y H:i" }}
                {% endif %}
              </div>
              <div class="progress rounded-pill bg-light mb-2" style="height:8px;">
                <div class="progress-bar bg-primary" role="progressbar" style="width: {{ it.progress_percent|floatformat:"0" }}%;" aria-valuenow="{{ it.progress_percent|floatformat:"0" }}" aria-valuemin="0" aria-valuemax="100"></div>
              </div>
              <div class="d-flex justify-content-between align-items-center small text-muted mb-3">
                <span>{{ it.progress_percent|floatformat:"0" }}%</span>
                {% if it.progress_current_page %}
                  <span>{{ it.progress_current_page }} —Å—Ç—Ä.</span>
                {% elif it.progress_total_pages %}
                  <span>{{ it.progress_total_pages }} —Å—Ç—Ä.</span>
                {% endif %}
              </div>
            {% else %}
              <div class="alert alert-light border small mb-3">–ü—Ä–æ–≥—Ä–µ—Å—Å –µ—â—ë –Ω–µ –æ—Ç–º–µ—á–µ–Ω.</div>
            {% endif %}
          <div class="mt-auto d-flex flex-column gap-2">
              <a class="btn btn-primary w-100" href="{% url 'reading_track' it.book.id %}">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —á—Ç–µ–Ω–∏–µ</a>
              <a class="btn btn-outline-secondary w-100" href="{% url 'book_detail' it.book.id %}">–û –∫–Ω–∏–≥–µ</a>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>
{% endif %}
{% endblock %}
