{% extends "base.html" %}
{% load static %}

{% block title %}Игры — Калейдоскоп книг{% endblock %}

{% block extra_css %}
{{ block.super }}
<style>
  :root {
    --games-ink: #2b3e34;
    --games-fern: #546a50;
    --games-sage: #6f8973;
    --games-mist: rgba(84, 106, 80, 0.18);
    --games-foam: #f1f6f2;
    --games-moss: #d9e4db;
  }

  .games-heading {
    --games-logo-size: clamp(105px, 11vw, 145px);
    --games-logo-height: clamp(88px, 9vw, 120px);
    border-radius: 1.5rem;
    background: linear-gradient(140deg, rgba(241, 246, 242, 0.95), rgba(217, 228, 219, 0.9));
    border: 1px solid rgba(84, 106, 80, 0.25);
    box-shadow: 0 18px 36px rgba(43, 62, 52, 0.08);
    color: var(--games-ink);
  }

  .games-heading__description {
    color: rgba(43, 62, 52, 0.75);
  }

  .games-heading__meta {
    background: rgba(255, 255, 255, 0.78);
    border-radius: 1.1rem;
    padding: 0.85rem 1.25rem;
    border: 1px solid rgba(84, 106, 80, 0.28);
    box-shadow: 0 12px 24px rgba(43, 62, 52, 0.08);
    color: rgba(43, 62, 52, 0.7);
  }

  .games-heading__logo-wrapper {
    flex: none;
    inline-size: var(--games-logo-size);
    width: var(--games-logo-size);
    max-inline-size: 100%;
    max-width: 100%;
    filter: drop-shadow(0 16px 28px rgba(43, 62, 52, 0.12));
    align-self: center;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .games-heading__logo {
    display: block;
    inline-size: min(100%, var(--games-logo-size));
    width: min(100%, var(--games-logo-size));
    max-inline-size: 100%;
    max-block-size: var(--games-logo-height);
    height: auto;
    border-radius: 1.25rem;
    object-fit: contain;
  }

  .games-section {
    color: var(--games-ink);
  }

  .games-section__badge {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    padding: 0.45rem 0.9rem;
    border-radius: 999px;
    font-size: 0.75rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    background: rgba(84, 106, 80, 0.16);
    color: var(--games-fern);
    border: 1px solid rgba(84, 106, 80, 0.28);
    box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.4);
  }

  .games-section__badge::before {
    content: "";
    width: 0.6rem;
    height: 0.6rem;
    border-radius: 50%;
    background: radial-gradient(circle at center, var(--games-fern), rgba(84, 106, 80, 0.25));
  }

  .games-section__badge--soft {
    background: rgba(84, 106, 80, 0.12);
    color: rgba(43, 62, 52, 0.75);
  }

  .games-card {
    position: relative;
    border-radius: 1.5rem;
    overflow: hidden;
    color: var(--games-ink);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  .games-card::after {
    content: "";
    position: absolute;
    inset: 0;
    pointer-events: none;
    border-radius: inherit;
    box-shadow: inset 0 0 0 1px rgba(84, 106, 80, 0.22);
  }

  .games-card--available {
    background: linear-gradient(165deg, rgba(241, 246, 242, 0.96), rgba(217, 228, 219, 0.25));
    box-shadow: 0 20px 40px rgba(43, 62, 52, 0.08);
  }

  .games-card--available:hover {
    transform: translateY(-4px);
    box-shadow: 0 24px 48px rgba(43, 62, 52, 0.12);
  }

  .games-card--upcoming {
    background: linear-gradient(165deg, rgba(255, 255, 255, 0.92), rgba(217, 228, 219, 0.18));
    border: 1px dashed var(--games-mist);
    box-shadow: 0 16px 32px rgba(43, 62, 52, 0.05);
  }

  .games-card__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .games-card__icon {
    font-size: clamp(2.5rem, 3vw + 1rem, 3rem);
    line-height: 1;
  }

  .games-card__badge {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    padding: 0.35rem 0.8rem;
    border-radius: 999px;
    font-size: 0.75rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    background: rgba(84, 106, 80, 0.14);
    color: var(--games-fern);
    border: 1px solid rgba(84, 106, 80, 0.26);
    box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.38);
  }

  .games-card__badge--warning {
    background: rgba(122, 149, 124, 0.22);
    color: #2b3e34;
    border-color: rgba(84, 106, 80, 0.3);
  }

  .games-card__badge--secondary {
    background: rgba(84, 106, 80, 0.12);
    color: rgba(43, 62, 52, 0.75);
    border-color: rgba(43, 62, 52, 0.26);
  }

  .games-card__title {
    margin-bottom: 0.5rem;
    color: var(--games-ink);
  }

  .games-card__description {
    color: rgba(43, 62, 52, 0.7);
  }

  .games-card__highlights {
    list-style: none;
    padding-left: 0;
    margin-bottom: 1.5rem;
    margin-top: 1.25rem;
    display: grid;
    gap: 0.45rem;
    color: rgba(43, 62, 52, 0.75);
    font-size: 0.95rem;
  }

  .games-card__highlights li {
    position: relative;
    padding-left: 1.8rem;
  }

  .games-card__highlights li::before {
    content: "\f26e";
    font-family: "Bootstrap Icons";
    position: absolute;
    left: 0;
    top: 0.1rem;
    width: 1.4rem;
    height: 1.4rem;
    border-radius: 0.55rem;
    display: grid;
    place-items: center;
    background: rgba(84, 106, 80, 0.18);
    color: var(--games-ink);
    font-size: 0.75rem;
  }

  .games-card__highlights--muted {
    color: rgba(43, 62, 52, 0.6);
  }

  .games-card__highlights--muted li::before {
    background: rgba(84, 106, 80, 0.12);
    color: rgba(43, 62, 52, 0.6);
  }

  .games-card__note {
    font-size: 0.9rem;
    color: rgba(43, 62, 52, 0.6);
    margin-top: auto;
  }

  .btn-games-primary {
    border-radius: 0.95rem;
    padding: 0.55rem 1.4rem;
    font-weight: 600;
    background: linear-gradient(140deg, var(--games-fern), var(--games-ink));
    color: #fff;
    border: 1px solid rgba(43, 62, 52, 0.45);
    box-shadow: 0 16px 28px rgba(43, 62, 52, 0.15);
    transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
  }

  .btn-games-primary:hover,
  .btn-games-primary:focus-visible {
    color: #fff;
    transform: translateY(-2px);
    box-shadow: 0 18px 36px rgba(43, 62, 52, 0.2);
    background: linear-gradient(140deg, var(--games-ink), #1c2a23);
  }

  @media (max-width: 991.98px) {
    .games-heading {
      --games-logo-size: clamp(130px, 35vw, 200px);
      --games-logo-height: clamp(110px, 30vw, 180px);
    }

    .games-heading .card-body {
      text-align: center;
      align-items: center;
      padding: clamp(1.5rem, 4vw + 1rem, 2.25rem);
    }

    .games-heading__logo-wrapper {
      margin-inline: auto;
    }

    .games-heading__meta {
      width: 100%;
      justify-content: center;
      text-align: center;
    }
  }

  @media (max-width: 767.98px) {
    .games-heading {
      border-radius: 1.25rem;
    }

    .games-heading__meta {
      width: 100%;
      text-align: center;
    }

    .games-card {
      border-radius: 1.25rem;
    }
  }

  @media (max-width: 575.98px) {
    .games-heading {
      --games-logo-size: clamp(150px, 62vw, 210px);
      --games-logo-height: clamp(130px, 50vw, 190px);
    }

    .games-heading__meta {
      gap: 0.25rem;
      padding: 0.75rem 1rem;
    }

    .games-card {
      border-radius: 1rem;
    }
  }

  /* Дополнительные правки размера логотипа */
  .games-heading .games-heading__logo-wrapper {
    width: auto !important;
    max-width: 180px !important;
  }

  .games-heading .games-heading__logo {
    width: auto !important;
    max-width: 100% !important;
    max-height: 160px !important;
    object-fit: contain !important;
  }
</style>
{% endblock %}

{% block content %}
<div class="games-heading card border-0 shadow-sm mb-5">
  <div class="card-body d-flex flex-column flex-lg-row align-items-lg-center justify-content-between gap-3">
    <div>
      <h1 class="h2 mb-2">Игры и челленджи</h1>
      <p class="games-heading__description mb-0">
        Собрали все игровые форматы ReadTogether в одном месте. Здесь можно подключать активные приключения
        и следить за тем, что появится дальше.
      </p>
    </div>
    <div class="games-heading__logo-wrapper">
      <img class="games-heading__logo" src="{{ MEDIA_URL }}config/img/gamelogo.png" alt="Логотип игровых приключений">
    </div>
    <div class="text-lg-end games-heading__meta small">
      <div>Активных игр: {{ available_games|length }}</div>
      <div>Скоро выйдет: {{ upcoming_games|length }}</div>
    </div>
  </div>
</div>

{% if available_games %}
<section class="games-section mb-5">
  <div class="d-flex align-items-center justify-content-between gap-3 mb-4 flex-wrap">
    <h2 class="h4 mb-0">Доступные игры</h2>
    <span class="games-section__badge">Коллекция приключений</span>
  </div>
  <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4">
    {% for card in available_games %}
    <div class="col">
      <article class="games-card games-card--available card h-100 border-0 shadow-sm">
        <div class="card-body d-flex flex-column">
          <div class="games-card__header">
            <span class="games-card__icon" aria-hidden="true">{{ card.icon }}</span>
            {% if card.badge %}
              <span class="games-card__badge games-card__badge--{{ card.badge_variant }}">{{ card.badge }}</span>
            {% endif %}
          </div>
          <h3 class="games-card__title h5">{{ card.title }}</h3>
          <p class="games-card__description">{{ card.description }}</p>
          {% if card.highlights %}
          <ul class="games-card__highlights">
            {% for highlight in card.highlights %}
            <li>{{ highlight }}</li>
            {% endfor %}
          </ul>
          {% endif %}
          <a class="btn btn-games-primary mt-auto align-self-start" href="{{ card.resolve_url }}">
            Перейти в игру
          </a>
        </div>
      </article>
    </div>
    {% endfor %}
  </div>
</section>
{% endif %}

{% if upcoming_games %}
<section class="games-section games-section--upcoming">
  <div class="d-flex align-items-center justify-content-between gap-3 mb-4 flex-wrap">
    <h2 class="h4 mb-0">Скоро появятся</h2>
    <span class="games-section__badge games-section__badge--soft">Анонсы и идеи</span>
  </div>
  <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4">
    {% for card in upcoming_games %}
    <div class="col">
      <article class="games-card games-card--upcoming card h-100 border-0">
        <div class="card-body d-flex flex-column">
          <div class="games-card__header">
            <span class="games-card__icon" aria-hidden="true">{{ card.icon }}</span>
            {% if card.badge %}
              <span class="games-card__badge games-card__badge--{{ card.badge_variant }}">{{ card.badge }}</span>
            {% endif %}
          </div>
          <h3 class="games-card__title h5">{{ card.title }}</h3>
          <p class="games-card__description">{{ card.description }}</p>
          {% if card.highlights %}
          <ul class="games-card__highlights games-card__highlights--muted">
            {% for highlight in card.highlights %}
            <li>{{ highlight }}</li>
            {% endfor %}
          </ul>
          {% else %}
          <p class="games-card__note">Следите за новостями — скоро расскажем детали.</p>
          {% endif %}
        </div>
      </article>
    </div>
    {% endfor %}
  </div>
</section>
{% endif %}
{% if not user.profile.has_active_premium %}
<!-- Yandex.RTB R-A-17641153-1 -->
<script>
window.yaContextCb.push(() => {
    Ya.Context.AdvManager.render({
        "blockId": "R-A-17641153-1",
        "type": "floorAd",
        "platform": "desktop"
    })
})
</script>
<!-- Yandex.RTB R-A-17641153-4 -->
<script>
window.yaContextCb.push(() => {
    Ya.Context.AdvManager.render({
        "blockId": "R-A-17641153-4",
        "type": "floorAd",
        "platform": "touch"
    })
})
</script>
{% endif %}
{% endblock %}